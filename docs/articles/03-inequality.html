<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Inequality Measurement  • convey</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Inequality Measurement ">
<meta property="og:description" content="convey">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">convey</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/01-Introduction.html">01- Poverty and Inequality with Complex Survey Data</a>
    </li>
    <li>
      <a href="../articles/02-poverty.html">Poverty Indices</a>
    </li>
    <li>
      <a href="../articles/03-inequality.html">Inequality Measurement </a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ajdamico/convey/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Inequality Measurement</h1>
                        <h4 data-toc-skip class="author">Guilherme
Jacob, Anthony Damico, and Djalma Pessoa</h4>
            
            <h4 data-toc-skip class="date">2022-09-06</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ajdamico/convey/blob/HEAD/vignettes/03-inequality.Rmd" class="external-link"><code>vignettes/03-inequality.Rmd</code></a></small>
      <div class="hidden name"><code>03-inequality.Rmd</code></div>

    </div>

    
    
<p>Another problem faced by societies is inequality. Economic inequality
can have several different meanings: income, education, resources,
opportunities, wellbeing, etc. Usually, studies on economic inequality
focus on income distribution.</p>
<p>Most inequality data comes from censuses and household surveys.
Therefore, in order to produce reliable estimates from this samples,
appropriate procedures are necessary.</p>
<p>This chapter presents brief presentations on inequality measures,
also providing replication examples if possible. It starts with an
initial attempt to measure the inequality between two groups of a
population; then, it presents ideas of overall inequality indices,
moving from the quintile share ratio to the Lorenz curve and measures
derived from it; then, it discusses the concept of entropy and presents
inequality measures based on it. Finally, it ends with a discussion
regarding which inequality measure should be used.</p>
<div class="section level2">
<h2 id="the-gender-pay-gap-svygpg">The Gender Pay Gap (svygpg)<a class="anchor" aria-label="anchor" href="#the-gender-pay-gap-svygpg"></a>
</h2>
<p>Although the <span class="math inline">\(GPG\)</span> is not an
inequality measure in the usual sense, it can still be an useful
instrument to evaluate the discrimination among men and women. Put
simply, it expresses the relative difference between the average hourly
earnings of men and women, presenting it as a percentage of the average
of hourly earnings of men.</p>
<p>In mathematical terms, this index can be described as,</p>
<p><span class="math display">\[ GPG = \frac{ \bar{y}_{male} -
\bar{y}_{female} }{ \bar{y}_{male} } \]</span>,</p>
<p>which is precisely the estimator used in the package. As we can see
from the formula, if there is no difference among classes, <span class="math inline">\(GPG = 0\)</span>. Else, if <span class="math inline">\(GPG &gt; 0\)</span>, it means that the average
hourly income received by women are <span class="math inline">\(GPG\)</span> percent smaller than men’s. For
negative <span class="math inline">\(GPG\)</span>, it means that women’s
hourly earnings are <span class="math inline">\(GPG\)</span> percent
larger than men’s. In other words, the larger the <span class="math inline">\(GPG\)</span>, larger is the shortfall of women’s
hourly earnings.</p>
<p>We can also develop a more straightforward idea: for every $1 raise
in men’s hourly earnings, women’s hourly earnings are expected to
increase $<span class="math inline">\((1-GPG)\)</span>. For instance,
assuming <span class="math inline">\(GPG = 0.8\)</span>, for every $1.00
increase in men’s average hourly earnings, women’s hourly earnings would
increase only $0.20.</p>
<p>The details of the linearization of the <code>GPG</code> are
discussed by <span class="citation">Deville (1999)</span> and <span class="citation">Osier (2009)</span>.</p>
<hr>
<p><strong>A replication example</strong></p>
<p>The R <code>vardpoor</code> package <span class="citation">(Breidaks,
Liberts, and Ivanova 2016)</span>, created by researchers at the Central
Statistical Bureau of Latvia, includes a gpg coefficient calculation
using the ultimate cluster method. The example below reproduces those
statistics.</p>
<p>Load and prepare the same data set:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load the convey package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://guilhermejacob.github.io/context/" class="external-link">convey</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># load the survey library</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://r-survey.r-forge.r-project.org/survey/" class="external-link">survey</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: grid</span></span>
<span><span class="co">#&gt; Loading required package: Matrix</span></span>
<span><span class="co">#&gt; Loading required package: survival</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'survey'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:graphics':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     dotchart</span></span>
<span></span>
<span><span class="co"># load the vardpoor library</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://csblatvia.github.io/vardpoor/" class="external-link">vardpoor</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># load the laeken library</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">laeken</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># load the synthetic EU statistics on income &amp; living conditions</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">eusilc</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># make all column names lowercase</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span> <span class="va">eusilc</span> <span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">tolower</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span> <span class="va">eusilc</span> <span class="op">)</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># coerce the gender variable to numeric 1 or 2</span></span>
<span><span class="va">eusilc</span><span class="op">$</span><span class="va">one_two</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span> <span class="va">eusilc</span><span class="op">$</span><span class="va">rb090</span> <span class="op">==</span> <span class="st">"female"</span> <span class="op">)</span> <span class="op">+</span> <span class="fl">1</span></span>
<span></span>
<span><span class="co"># add a column with the row number</span></span>
<span><span class="va">dati</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span>IDd <span class="op">=</span> <span class="fl">1</span> <span class="op">:</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">eusilc</span><span class="op">)</span>, <span class="va">eusilc</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># calculate the gpg coefficient</span></span>
<span><span class="co"># using the R vardpoor library</span></span>
<span><span class="va">varpoord_gpg_calculation</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/vardpoor/man/varpoord.html" class="external-link">varpoord</a></span><span class="op">(</span></span>
<span>    </span>
<span>        <span class="co"># analysis variable</span></span>
<span>        Y <span class="op">=</span> <span class="st">"eqincome"</span>, </span>
<span>        </span>
<span>        <span class="co"># weights variable</span></span>
<span>        w_final <span class="op">=</span> <span class="st">"rb050"</span>,</span>
<span>        </span>
<span>        <span class="co"># row number variable</span></span>
<span>        ID_level1 <span class="op">=</span> <span class="st">"IDd"</span>,</span>
<span>        </span>
<span>        <span class="co"># row number variable</span></span>
<span>        ID_level2 <span class="op">=</span> <span class="st">"IDd"</span>,</span>
<span>        </span>
<span>        <span class="co"># strata variable</span></span>
<span>        H <span class="op">=</span> <span class="st">"db040"</span>, </span>
<span>        </span>
<span>        N_h <span class="op">=</span> <span class="cn">NULL</span> ,</span>
<span>        </span>
<span>        <span class="co"># clustering variable</span></span>
<span>        PSU <span class="op">=</span> <span class="st">"rb030"</span>, </span>
<span>        </span>
<span>        <span class="co"># data.table</span></span>
<span>        dataset <span class="op">=</span> <span class="va">dati</span>, </span>
<span>        </span>
<span>        <span class="co"># gpg coefficient function</span></span>
<span>        type <span class="op">=</span> <span class="st">"lingpg"</span> ,</span>
<span>        </span>
<span>        <span class="co"># gender variable</span></span>
<span>        gender <span class="op">=</span> <span class="st">"one_two"</span>,</span>
<span>      </span>
<span>      <span class="co"># poverty threshold range</span></span>
<span>      order_quant <span class="op">=</span> <span class="fl">50L</span> ,</span>
<span>      </span>
<span>      <span class="co"># get linearized variable</span></span>
<span>      outp_lin <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="co"># construct a survey.design</span></span>
<span><span class="co"># using our recommended setup</span></span>
<span><span class="va">des_eusilc</span> <span class="op">&lt;-</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/survey/man/svydesign.html" class="external-link">svydesign</a></span><span class="op">(</span> </span>
<span>        ids <span class="op">=</span> <span class="op">~</span> <span class="va">rb030</span> , </span>
<span>        strata <span class="op">=</span> <span class="op">~</span> <span class="va">db040</span> ,  </span>
<span>        weights <span class="op">=</span> <span class="op">~</span> <span class="va">rb050</span> , </span>
<span>        data <span class="op">=</span> <span class="va">eusilc</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="co"># immediately run the convey_prep function on it</span></span>
<span><span class="va">des_eusilc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/convey_prep.html">convey_prep</a></span><span class="op">(</span> <span class="va">des_eusilc</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># coefficients do match</span></span>
<span><span class="va">varpoord_gpg_calculation</span><span class="op">$</span><span class="va">all_result</span><span class="op">$</span><span class="va">value</span></span>
<span><span class="co">#&gt; [1] 7.645389</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span> <span class="fu"><a href="../reference/svygpg.html">svygpg</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">eqincome</span> , <span class="va">des_eusilc</span> , sex <span class="op">=</span> <span class="op">~</span> <span class="va">rb090</span> <span class="op">)</span> <span class="op">)</span> <span class="op">*</span> <span class="fl">100</span></span>
<span><span class="co">#&gt; eqincome </span></span>
<span><span class="co">#&gt; 7.645389</span></span>
<span></span>
<span><span class="co"># linearized variables do match</span></span>
<span><span class="co"># vardpoor</span></span>
<span><span class="va">lin_gpg_varpoord</span><span class="op">&lt;-</span> <span class="va">varpoord_gpg_calculation</span><span class="op">$</span><span class="va">lin_out</span><span class="op">$</span><span class="va">lin_gpg</span></span>
<span><span class="co"># convey </span></span>
<span><span class="va">lin_gpg_convey</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="fu"><a href="../reference/svygpg.html">svygpg</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">eqincome</span> , <span class="va">des_eusilc</span>, sex <span class="op">=</span> <span class="op">~</span> <span class="va">rb090</span> <span class="op">)</span>,<span class="st">"lin"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># check equality</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">lin_gpg_varpoord</span>,<span class="fl">100</span><span class="op">*</span><span class="va">lin_gpg_convey</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="co"># variances do not match exactly</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span> <span class="fu"><a href="../reference/svygpg.html">svygpg</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">eqincome</span> , <span class="va">des_eusilc</span> , sex <span class="op">=</span> <span class="op">~</span> <span class="va">rb090</span> <span class="op">)</span> , <span class="st">'var'</span> <span class="op">)</span> <span class="op">*</span> <span class="fl">10000</span></span>
<span><span class="co">#&gt;           eqincome</span></span>
<span><span class="co">#&gt; eqincome 0.6493911</span></span>
<span><span class="va">varpoord_gpg_calculation</span><span class="op">$</span><span class="va">all_result</span><span class="op">$</span><span class="va">var</span></span>
<span><span class="co">#&gt; [1] 0.6482346</span></span>
<span></span>
<span><span class="co"># standard errors do not match exactly</span></span>
<span><span class="va">varpoord_gpg_calculation</span><span class="op">$</span><span class="va">all_result</span><span class="op">$</span><span class="va">se</span></span>
<span><span class="co">#&gt; [1] 0.8051301</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/survey/man/SE.html" class="external-link">SE</a></span><span class="op">(</span> <span class="fu"><a href="../reference/svygpg.html">svygpg</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">eqincome</span> , <span class="va">des_eusilc</span> , sex <span class="op">=</span> <span class="op">~</span> <span class="va">rb090</span> <span class="op">)</span> <span class="op">)</span> <span class="op">*</span> <span class="fl">100</span></span>
<span><span class="co">#&gt;           eqincome</span></span>
<span><span class="co">#&gt; eqincome 0.8058481</span></span></code></pre></div>
<p>The variance estimate is computed by using the approximation defined
in @ref(eq:var), where the linearized variable <span class="math inline">\(z\)</span> is defined by @ref(eq:lin). The
functions <code><a href="../reference/svygpg.html">convey::svygpg</a></code> and <code><a href="https://rdrr.io/pkg/vardpoor/man/lingpg.html" class="external-link">vardpoor::lingpg</a></code>
produce the same linearized variable <span class="math inline">\(z\)</span>.</p>
<p>However, the measures of uncertainty do not line up, because
<code><a href="https://csblatvia.github.io/vardpoor/" class="external-link">library(vardpoor)</a></code> defaults to an ultimate cluster method
that can be replicated with an alternative setup of the
<code>survey.design</code> object.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># within each strata, sum up the weights</span></span>
<span><span class="va">cluster_sums</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span> <span class="va">eusilc</span><span class="op">$</span><span class="va">rb050</span> , <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span> <span class="va">eusilc</span><span class="op">$</span><span class="va">db040</span> <span class="op">)</span> , <span class="va">sum</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># name the within-strata sums of weights the `cluster_sum`</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span> <span class="va">cluster_sums</span> <span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="st">"db040"</span> , <span class="st">"cluster_sum"</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># merge this column back onto the data.frame</span></span>
<span><span class="va">eusilc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span> <span class="va">eusilc</span> , <span class="va">cluster_sums</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># construct a survey.design</span></span>
<span><span class="co"># with the fpc using the cluster sum</span></span>
<span><span class="va">des_eusilc_ultimate_cluster</span> <span class="op">&lt;-</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/survey/man/svydesign.html" class="external-link">svydesign</a></span><span class="op">(</span> </span>
<span>        ids <span class="op">=</span> <span class="op">~</span> <span class="va">rb030</span> , </span>
<span>        strata <span class="op">=</span> <span class="op">~</span> <span class="va">db040</span> ,  </span>
<span>        weights <span class="op">=</span> <span class="op">~</span> <span class="va">rb050</span> , </span>
<span>        data <span class="op">=</span> <span class="va">eusilc</span> , </span>
<span>        fpc <span class="op">=</span> <span class="op">~</span> <span class="va">cluster_sum</span> </span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="co"># again, immediately run the convey_prep function on the `survey.design`</span></span>
<span><span class="va">des_eusilc_ultimate_cluster</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/convey_prep.html">convey_prep</a></span><span class="op">(</span> <span class="va">des_eusilc_ultimate_cluster</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># matches</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span> <span class="fu"><a href="../reference/svygpg.html">svygpg</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">eqincome</span> , <span class="va">des_eusilc_ultimate_cluster</span> , sex <span class="op">=</span> <span class="op">~</span> <span class="va">rb090</span> <span class="op">)</span> , <span class="st">'var'</span> <span class="op">)</span> <span class="op">*</span> <span class="fl">10000</span></span>
<span><span class="co">#&gt;           eqincome</span></span>
<span><span class="co">#&gt; eqincome 0.6482346</span></span>
<span><span class="va">varpoord_gpg_calculation</span><span class="op">$</span><span class="va">all_result</span><span class="op">$</span><span class="va">var</span></span>
<span><span class="co">#&gt; [1] 0.6482346</span></span>
<span></span>
<span><span class="co"># matches</span></span>
<span><span class="va">varpoord_gpg_calculation</span><span class="op">$</span><span class="va">all_result</span><span class="op">$</span><span class="va">se</span></span>
<span><span class="co">#&gt; [1] 0.8051301</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/survey/man/SE.html" class="external-link">SE</a></span><span class="op">(</span> <span class="fu"><a href="../reference/svygpg.html">svygpg</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">eqincome</span> , <span class="va">des_eusilc_ultimate_cluster</span> , sex <span class="op">=</span> <span class="op">~</span> <span class="va">rb090</span> <span class="op">)</span> <span class="op">)</span> <span class="op">*</span> <span class="fl">100</span></span>
<span><span class="co">#&gt;           eqincome</span></span>
<span><span class="co">#&gt; eqincome 0.8051301</span></span></code></pre></div>
<p>For additional usage examples of <code>svygpg</code>, type
<code><a href="../reference/svygpg.html">?convey::svygpg</a></code> in the R console.</p>
</div>
<div class="section level2">
<h2 id="quintile-share-ratio-svyqsr">Quintile Share Ratio (svyqsr)<a class="anchor" aria-label="anchor" href="#quintile-share-ratio-svyqsr"></a>
</h2>
<p>Unlike the previous measure, the quintile share ratio is an
inequality measure in itself, depending only of the income distribution
to evaluate the degree of inequality. By definition, it can be described
as the ratio between the income share held by the richest 20% and the
poorest 20% of the population.</p>
<p>In plain terms, it expresses how many times the wealthier part of the
population are richer than the poorest part. For instance, a <span class="math inline">\(QSR = 4\)</span> implies that the upper class owns
4 times as much of the total income as the poor.</p>
<p>The quintile share ratio can be modified to a more general function
of fractile share ratios. For instance, <span class="citation">Cobham,
Schlogl, and Sumner (2015)</span> presents interesting arguments for
using the Palma index, defined as the ratio between the share of the 10%
richest over the share held by the poorest 40%.</p>
<p>The details of the linearization of the <code>QSR</code> are
discussed by <span class="citation">Deville (1999)</span> and <span class="citation">Osier (2009)</span>.</p>
<hr>
<p><strong>A replication example</strong></p>
<p>The R <code>vardpoor</code> package <span class="citation">(Breidaks,
Liberts, and Ivanova 2016)</span>, created by researchers at the Central
Statistical Bureau of Latvia, includes a qsr coefficient calculation
using the ultimate cluster method. The example below reproduces those
statistics.</p>
<p>Load and prepare the same data set:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load the convey package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://guilhermejacob.github.io/context/" class="external-link">convey</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># load the survey library</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://r-survey.r-forge.r-project.org/survey/" class="external-link">survey</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># load the vardpoor library</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://csblatvia.github.io/vardpoor/" class="external-link">vardpoor</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># load the laeken library</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">laeken</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># load the synthetic EU statistics on income &amp; living conditions</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">eusilc</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># make all column names lowercase</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span> <span class="va">eusilc</span> <span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">tolower</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span> <span class="va">eusilc</span> <span class="op">)</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># add a column with the row number</span></span>
<span><span class="va">dati</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span>IDd <span class="op">=</span> <span class="fl">1</span> <span class="op">:</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">eusilc</span><span class="op">)</span>, <span class="va">eusilc</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># calculate the qsr coefficient</span></span>
<span><span class="co"># using the R vardpoor library</span></span>
<span><span class="va">varpoord_qsr_calculation</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/vardpoor/man/varpoord.html" class="external-link">varpoord</a></span><span class="op">(</span></span>
<span>    </span>
<span>        <span class="co"># analysis variable</span></span>
<span>        Y <span class="op">=</span> <span class="st">"eqincome"</span>, </span>
<span>        </span>
<span>        <span class="co"># weights variable</span></span>
<span>        w_final <span class="op">=</span> <span class="st">"rb050"</span>,</span>
<span>        </span>
<span>        <span class="co"># row number variable</span></span>
<span>        ID_level1 <span class="op">=</span> <span class="st">"IDd"</span>,</span>
<span>        </span>
<span>        <span class="co"># row number variable</span></span>
<span>        ID_level2 <span class="op">=</span> <span class="st">"IDd"</span>,</span>
<span>        </span>
<span>        <span class="co"># strata variable</span></span>
<span>        H <span class="op">=</span> <span class="st">"db040"</span>, </span>
<span>        </span>
<span>        N_h <span class="op">=</span> <span class="cn">NULL</span> ,</span>
<span>        </span>
<span>        <span class="co"># clustering variable</span></span>
<span>        PSU <span class="op">=</span> <span class="st">"rb030"</span>, </span>
<span>        </span>
<span>        <span class="co"># data.table</span></span>
<span>        dataset <span class="op">=</span> <span class="va">dati</span>, </span>
<span>        </span>
<span>        <span class="co"># qsr coefficient function</span></span>
<span>        type <span class="op">=</span> <span class="st">"linqsr"</span>,</span>
<span>      </span>
<span>      <span class="co"># poverty threshold range</span></span>
<span>      order_quant <span class="op">=</span> <span class="fl">50L</span> ,</span>
<span>      </span>
<span>      <span class="co"># get linearized variable</span></span>
<span>      outp_lin <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>        </span>
<span>    <span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="co"># construct a survey.design</span></span>
<span><span class="co"># using our recommended setup</span></span>
<span><span class="va">des_eusilc</span> <span class="op">&lt;-</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/survey/man/svydesign.html" class="external-link">svydesign</a></span><span class="op">(</span> </span>
<span>        ids <span class="op">=</span> <span class="op">~</span> <span class="va">rb030</span> , </span>
<span>        strata <span class="op">=</span> <span class="op">~</span> <span class="va">db040</span> ,  </span>
<span>        weights <span class="op">=</span> <span class="op">~</span> <span class="va">rb050</span> , </span>
<span>        data <span class="op">=</span> <span class="va">eusilc</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="co"># immediately run the convey_prep function on it</span></span>
<span><span class="va">des_eusilc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/convey_prep.html">convey_prep</a></span><span class="op">(</span> <span class="va">des_eusilc</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># coefficients do match</span></span>
<span><span class="va">varpoord_qsr_calculation</span><span class="op">$</span><span class="va">all_result</span><span class="op">$</span><span class="va">value</span></span>
<span><span class="co">#&gt; [1] 3.970004</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span> <span class="fu"><a href="../reference/svyqsr.html">svyqsr</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">eqincome</span> , <span class="va">des_eusilc</span> <span class="op">)</span> <span class="op">)</span></span>
<span><span class="co">#&gt; eqincome </span></span>
<span><span class="co">#&gt; 3.970004</span></span>
<span></span>
<span><span class="co"># linearized variables do match</span></span>
<span><span class="co"># vardpoor</span></span>
<span><span class="va">lin_qsr_varpoord</span><span class="op">&lt;-</span> <span class="va">varpoord_qsr_calculation</span><span class="op">$</span><span class="va">lin_out</span><span class="op">$</span><span class="va">lin_qsr</span></span>
<span><span class="co"># convey </span></span>
<span><span class="va">lin_qsr_convey</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="../reference/svyqsr.html">svyqsr</a></span><span class="op">(</span> </span>
<span>            <span class="op">~</span> <span class="va">eqincome</span> , </span>
<span>            <span class="va">des_eusilc</span> , </span>
<span>            linearized <span class="op">=</span> <span class="cn">TRUE</span>  </span>
<span>          <span class="op">)</span> , </span>
<span>        <span class="st">"linearized"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># check equality</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">lin_qsr_varpoord</span>, <span class="va">lin_qsr_convey</span> <span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="co"># variances do not match exactly</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span> <span class="fu"><a href="../reference/svyqsr.html">svyqsr</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">eqincome</span> , <span class="va">des_eusilc</span> <span class="op">)</span> , <span class="st">'var'</span> <span class="op">)</span></span>
<span><span class="co">#&gt;             eqincome</span></span>
<span><span class="co">#&gt; eqincome 0.001810537</span></span>
<span><span class="va">varpoord_qsr_calculation</span><span class="op">$</span><span class="va">all_result</span><span class="op">$</span><span class="va">var</span></span>
<span><span class="co">#&gt; [1] 0.001807323</span></span>
<span></span>
<span><span class="co"># standard errors do not match exactly</span></span>
<span><span class="va">varpoord_qsr_calculation</span><span class="op">$</span><span class="va">all_result</span><span class="op">$</span><span class="va">se</span></span>
<span><span class="co">#&gt; [1] 0.04251263</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/survey/man/SE.html" class="external-link">SE</a></span><span class="op">(</span> <span class="fu"><a href="../reference/svyqsr.html">svyqsr</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">eqincome</span> , <span class="va">des_eusilc</span> <span class="op">)</span> <span class="op">)</span></span>
<span><span class="co">#&gt;            eqincome</span></span>
<span><span class="co">#&gt; eqincome 0.04255041</span></span></code></pre></div>
<p>The variance estimate is computed by using the approximation defined
in @ref(eq:var), where the linearized variable <span class="math inline">\(z\)</span> is defined by @ref(eq:lin). The
functions <code><a href="../reference/svygpg.html">convey::svygpg</a></code> and <code><a href="https://rdrr.io/pkg/vardpoor/man/lingpg.html" class="external-link">vardpoor::lingpg</a></code>
produce the same linearized variable <span class="math inline">\(z\)</span>.</p>
<p>However, the measures of uncertainty do not line up, because
<code><a href="https://csblatvia.github.io/vardpoor/" class="external-link">library(vardpoor)</a></code> defaults to an ultimate cluster method
that can be replicated with an alternative setup of the
<code>survey.design</code> object.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># within each strata, sum up the weights</span></span>
<span><span class="va">cluster_sums</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span> <span class="va">eusilc</span><span class="op">$</span><span class="va">rb050</span> , <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span> <span class="va">eusilc</span><span class="op">$</span><span class="va">db040</span> <span class="op">)</span> , <span class="va">sum</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># name the within-strata sums of weights the `cluster_sum`</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span> <span class="va">cluster_sums</span> <span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="st">"db040"</span> , <span class="st">"cluster_sum"</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># merge this column back onto the data.frame</span></span>
<span><span class="va">eusilc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span> <span class="va">eusilc</span> , <span class="va">cluster_sums</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># construct a survey.design</span></span>
<span><span class="co"># with the fpc using the cluster sum</span></span>
<span><span class="va">des_eusilc_ultimate_cluster</span> <span class="op">&lt;-</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/survey/man/svydesign.html" class="external-link">svydesign</a></span><span class="op">(</span> </span>
<span>        ids <span class="op">=</span> <span class="op">~</span> <span class="va">rb030</span> , </span>
<span>        strata <span class="op">=</span> <span class="op">~</span> <span class="va">db040</span> ,  </span>
<span>        weights <span class="op">=</span> <span class="op">~</span> <span class="va">rb050</span> , </span>
<span>        data <span class="op">=</span> <span class="va">eusilc</span> , </span>
<span>        fpc <span class="op">=</span> <span class="op">~</span> <span class="va">cluster_sum</span> </span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="co"># again, immediately run the convey_prep function on the `survey.design`</span></span>
<span><span class="va">des_eusilc_ultimate_cluster</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/convey_prep.html">convey_prep</a></span><span class="op">(</span> <span class="va">des_eusilc_ultimate_cluster</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># matches</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span> <span class="fu"><a href="../reference/svyqsr.html">svyqsr</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">eqincome</span> , <span class="va">des_eusilc_ultimate_cluster</span> <span class="op">)</span> , <span class="st">'var'</span> <span class="op">)</span></span>
<span><span class="co">#&gt;             eqincome</span></span>
<span><span class="co">#&gt; eqincome 0.001807323</span></span>
<span><span class="va">varpoord_qsr_calculation</span><span class="op">$</span><span class="va">all_result</span><span class="op">$</span><span class="va">var</span></span>
<span><span class="co">#&gt; [1] 0.001807323</span></span>
<span></span>
<span><span class="co"># matches</span></span>
<span><span class="va">varpoord_qsr_calculation</span><span class="op">$</span><span class="va">all_result</span><span class="op">$</span><span class="va">se</span></span>
<span><span class="co">#&gt; [1] 0.04251263</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/survey/man/SE.html" class="external-link">SE</a></span><span class="op">(</span> <span class="fu"><a href="../reference/svyqsr.html">svyqsr</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">eqincome</span> , <span class="va">des_eusilc_ultimate_cluster</span> <span class="op">)</span> <span class="op">)</span></span>
<span><span class="co">#&gt;            eqincome</span></span>
<span><span class="co">#&gt; eqincome 0.04251263</span></span></code></pre></div>
<p>For additional usage examples of <code>svyqsr</code>, type
<code><a href="../reference/svyqsr.html">?convey::svyqsr</a></code> in the R console.</p>
</div>
<div class="section level2">
<h2 id="lorenz-curve-svylorenz">Lorenz Curve (svylorenz)<a class="anchor" aria-label="anchor" href="#lorenz-curve-svylorenz"></a>
</h2>
<p>Though not an inequality measure in itself, the Lorenz curve is a
classic instrument of distribution analysis. Basically, it is a function
that associates a cumulative share of the population to the share of the
total income it owns. In mathematical terms,</p>
<p><span class="math display">\[
L(p) =
\frac{\int_{-\infty}^{Q_p}yf(y)dy}{\int_{-\infty}^{+\infty}yf(y)dy}
\]</span></p>
<p>where <span class="math inline">\(Q_p\)</span> is the quantile <span class="math inline">\(p\)</span> of the population.</p>
<p>The two extreme distributive cases are</p>
<ul>
<li>Perfect equality:
<ul>
<li>Every individual has the same income;</li>
<li>Every share of the population has the same share of the income;</li>
<li>Therefore, the reference curve is <span class="math display">\[L(p)
= p \text{ } \forall p \in [0,1] \text{.}\]</span>
</li>
</ul>
</li>
<li>Perfect inequality:
<ul>
<li>One individual concentrates all of society’s income, while the other
individuals have zero income;</li>
<li>Therefore, the reference curve is</li>
</ul>
</li>
</ul>
<p><span class="math display">\[
L(p)=
\begin{cases}
0, &amp;\forall p &lt; 1 \\
1, &amp;\text{if } p = 1 \text{.}
\end{cases}
\]</span></p>
<p>In order to evaluate the degree of inequality in a society, the
analyst looks at the distance between the real curve and those two
reference curves.</p>
<p>The estimator of this function was derived by <span class="citation">Kovacevic and Binder (1997)</span>:</p>
<p><span class="math display">\[
L(p) = \frac{ \sum_{i \in S} w_i \cdot y_i \cdot \delta \{ y_i \le
\widehat{Q}_p \}}{\widehat{Y}}, \text{ } 0 \le p \le 1.
\]</span></p>
<p>Yet, this formula is used to calculate specific points of the curve
and their respective SEs. The formula to plot an approximation of the
continuous empirical curve comes from <span class="citation">Lerman and
Yitzhaki (1989)</span>.</p>
<hr>
<p><strong>A replication example</strong></p>
<p>In October 2016, <span class="citation">(Jann 2016)</span> released a
pre-publication working paper to estimate lorenz and concentration
curves using stata. The example below reproduces the statistics
presented in his section 4.1.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load the convey package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://guilhermejacob.github.io/context/" class="external-link">convey</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># load the survey library</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://r-survey.r-forge.r-project.org/survey/" class="external-link">survey</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># load the stata-style webuse library</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/leeper/webuse" class="external-link">webuse</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># load the NLSW 1988 data</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/webuse/man/webuse.html" class="external-link">webuse</a></span><span class="op">(</span><span class="st">"nlsw88"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># coerce that `tbl_df` to a standard R `data.frame`</span></span>
<span><span class="va">nlsw88</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span> <span class="va">nlsw88</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># initiate a linearized survey design object</span></span>
<span><span class="va">des_nlsw88</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/svydesign.html" class="external-link">svydesign</a></span><span class="op">(</span> ids <span class="op">=</span> <span class="op">~</span><span class="fl">1</span> , data <span class="op">=</span> <span class="va">nlsw88</span> <span class="op">)</span></span>
<span><span class="co">#&gt; Warning in svydesign.default(ids = ~1, data = nlsw88): No weights or</span></span>
<span><span class="co">#&gt; probabilities supplied, assuming equal probability</span></span>
<span></span>
<span><span class="co"># immediately run the `convey_prep` function on the survey design</span></span>
<span><span class="va">des_nlsw88</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/convey_prep.html">convey_prep</a></span><span class="op">(</span><span class="va">des_nlsw88</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># estimates lorenz curve</span></span>
<span><span class="va">result.lin</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/svylorenz.html">svylorenz</a></span><span class="op">(</span> <span class="op">~</span><span class="va">wage</span>, <span class="va">des_nlsw88</span>, quantiles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span> <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">.05</span> <span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span> <span class="op">)</span></span></code></pre></div>
<p><img src="03-inequality_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span></span>
<span><span class="co"># note: most survey commands in R use Inf degrees of freedom by default</span></span>
<span><span class="co"># stata generally uses the degrees of freedom of the survey design.</span></span>
<span><span class="co"># therefore, while this extended syntax serves to prove a precise replication of stata</span></span>
<span><span class="co"># it is generally not necessary.</span></span>
<span><span class="va">section_four_one</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span> </span>
<span>        estimate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span> <span class="va">result.lin</span> <span class="op">)</span> , </span>
<span>        standard_error <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/SE.html" class="external-link">SE</a></span><span class="op">(</span> <span class="va">result.lin</span> <span class="op">)</span> , </span>
<span>        ci_lower_bound <span class="op">=</span> </span>
<span>            <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span> <span class="va">result.lin</span> <span class="op">)</span> <span class="op">+</span> </span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/survey/man/SE.html" class="external-link">SE</a></span><span class="op">(</span> <span class="va">result.lin</span> <span class="op">)</span> <span class="op">*</span> </span>
<span>            <span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">qt</a></span><span class="op">(</span> <span class="fl">0.025</span> , <span class="fu"><a href="https://rdrr.io/pkg/survey/man/svychisq.html" class="external-link">degf</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span> <span class="va">des_nlsw88</span> , <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span> <span class="va">wage</span> <span class="op">)</span> <span class="op">)</span> <span class="op">)</span> <span class="op">)</span> ,</span>
<span>        ci_upper_bound <span class="op">=</span> </span>
<span>            <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span> <span class="va">result.lin</span> <span class="op">)</span> <span class="op">+</span> </span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/survey/man/SE.html" class="external-link">SE</a></span><span class="op">(</span> <span class="va">result.lin</span> <span class="op">)</span> <span class="op">*</span> </span>
<span>            <span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">qt</a></span><span class="op">(</span> <span class="fl">0.975</span> , <span class="fu"><a href="https://rdrr.io/pkg/survey/man/svychisq.html" class="external-link">degf</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span> <span class="va">des_nlsw88</span> , <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span> <span class="va">wage</span> <span class="op">)</span> <span class="op">)</span> <span class="op">)</span> <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>    </span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="right">estimate</th>
<th align="right">standard_error</th>
<th align="right">ci_lower_bound</th>
<th align="right">ci_upper_bound</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">L(0)</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">L(0.05)</td>
<td align="right">0.0151060</td>
<td align="right">0.0004159</td>
<td align="right">0.0142904</td>
<td align="right">0.0159216</td>
</tr>
<tr class="odd">
<td align="left">L(0.1)</td>
<td align="right">0.0342651</td>
<td align="right">0.0007021</td>
<td align="right">0.0328882</td>
<td align="right">0.0356420</td>
</tr>
<tr class="even">
<td align="left">L(0.15)</td>
<td align="right">0.0558635</td>
<td align="right">0.0010096</td>
<td align="right">0.0538836</td>
<td align="right">0.0578434</td>
</tr>
<tr class="odd">
<td align="left">L(0.2)</td>
<td align="right">0.0801846</td>
<td align="right">0.0014032</td>
<td align="right">0.0774329</td>
<td align="right">0.0829363</td>
</tr>
<tr class="even">
<td align="left">L(0.25)</td>
<td align="right">0.1067687</td>
<td align="right">0.0017315</td>
<td align="right">0.1033732</td>
<td align="right">0.1101642</td>
</tr>
<tr class="odd">
<td align="left">L(0.3)</td>
<td align="right">0.1356307</td>
<td align="right">0.0021301</td>
<td align="right">0.1314535</td>
<td align="right">0.1398078</td>
</tr>
<tr class="even">
<td align="left">L(0.35)</td>
<td align="right">0.1670287</td>
<td align="right">0.0025182</td>
<td align="right">0.1620903</td>
<td align="right">0.1719670</td>
</tr>
<tr class="odd">
<td align="left">L(0.4)</td>
<td align="right">0.2005501</td>
<td align="right">0.0029161</td>
<td align="right">0.1948315</td>
<td align="right">0.2062687</td>
</tr>
<tr class="even">
<td align="left">L(0.45)</td>
<td align="right">0.2369209</td>
<td align="right">0.0033267</td>
<td align="right">0.2303971</td>
<td align="right">0.2434447</td>
</tr>
<tr class="odd">
<td align="left">L(0.5)</td>
<td align="right">0.2759734</td>
<td align="right">0.0037423</td>
<td align="right">0.2686347</td>
<td align="right">0.2833121</td>
</tr>
<tr class="even">
<td align="left">L(0.55)</td>
<td align="right">0.3180215</td>
<td align="right">0.0041626</td>
<td align="right">0.3098585</td>
<td align="right">0.3261844</td>
</tr>
<tr class="odd">
<td align="left">L(0.6)</td>
<td align="right">0.3633071</td>
<td align="right">0.0045833</td>
<td align="right">0.3543192</td>
<td align="right">0.3722950</td>
</tr>
<tr class="even">
<td align="left">L(0.65)</td>
<td align="right">0.4125183</td>
<td align="right">0.0050056</td>
<td align="right">0.4027021</td>
<td align="right">0.4223345</td>
</tr>
<tr class="odd">
<td align="left">L(0.7)</td>
<td align="right">0.4657641</td>
<td align="right">0.0054137</td>
<td align="right">0.4551478</td>
<td align="right">0.4763804</td>
</tr>
<tr class="even">
<td align="left">L(0.75)</td>
<td align="right">0.5241784</td>
<td align="right">0.0058003</td>
<td align="right">0.5128039</td>
<td align="right">0.5355529</td>
</tr>
<tr class="odd">
<td align="left">L(0.8)</td>
<td align="right">0.5880894</td>
<td align="right">0.0062464</td>
<td align="right">0.5758401</td>
<td align="right">0.6003388</td>
</tr>
<tr class="even">
<td align="left">L(0.85)</td>
<td align="right">0.6577051</td>
<td align="right">0.0066148</td>
<td align="right">0.6447333</td>
<td align="right">0.6706769</td>
</tr>
<tr class="odd">
<td align="left">L(0.9)</td>
<td align="right">0.7346412</td>
<td align="right">0.0068289</td>
<td align="right">0.7212497</td>
<td align="right">0.7480328</td>
</tr>
<tr class="even">
<td align="left">L(0.95)</td>
<td align="right">0.8265786</td>
<td align="right">0.0062686</td>
<td align="right">0.8142857</td>
<td align="right">0.8388715</td>
</tr>
<tr class="odd">
<td align="left">L(1)</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
<td align="right">1.0000000</td>
<td align="right">1.0000000</td>
</tr>
</tbody>
</table>
<p>For additional usage examples of <code>svylorenz</code>, type
<code><a href="../reference/svylorenz.html">?convey::svylorenz</a></code> in the R console.</p>
</div>
<div class="section level2">
<h2 id="gini-index-svygini">Gini index (svygini)<a class="anchor" aria-label="anchor" href="#gini-index-svygini"></a>
</h2>
<p>The Gini index is an attempt to express the inequality presented in
the Lorenz curve as a single number. In essence, it is twice the area
between the equality curve and the real Lorenz curve. Put simply:</p>
<p><span class="math display">\[
\begin{aligned}
G &amp;= 2 \bigg( \int_{0}^{1} pdp - \int_{0}^{1} L(p)dp \bigg) \\
\therefore G &amp;= 1 - 2 \int_{0}^{1} L(p)dp
\end{aligned}
\]</span></p>
<p>where <span class="math inline">\(G=0\)</span> in case of perfect
equality and <span class="math inline">\(G = 1\)</span> in the case of
perfect inequality.</p>
<p>The estimator proposed by <span class="citation">Osier (2009)</span>
is defined as:</p>
<p><span class="math display">\[
\widehat{G} = \frac{ 2 \sum_{i \in S} w_i r_i y_i - \sum_{i \in S} w_i
y_i }{ \hat{Y} }
\]</span></p>
<p>The linearized formula of <span class="math inline">\(\widehat{G}\)</span> is used to calculate the
SE.</p>
<hr>
<p><strong>A replication example</strong></p>
<p>The R <code>vardpoor</code> package <span class="citation">(Breidaks,
Liberts, and Ivanova 2016)</span>, created by researchers at the Central
Statistical Bureau of Latvia, includes a gini coefficient calculation
using the ultimate cluster method. The example below reproduces those
statistics.</p>
<p>Load and prepare the same data set:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load the convey package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://guilhermejacob.github.io/context/" class="external-link">convey</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># load the survey library</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://r-survey.r-forge.r-project.org/survey/" class="external-link">survey</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># load the vardpoor library</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://csblatvia.github.io/vardpoor/" class="external-link">vardpoor</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># load the laeken library</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">laeken</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># load the synthetic EU statistics on income &amp; living conditions</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">eusilc</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># make all column names lowercase</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span> <span class="va">eusilc</span> <span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">tolower</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span> <span class="va">eusilc</span> <span class="op">)</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># add a column with the row number</span></span>
<span><span class="va">dati</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span>IDd <span class="op">=</span> <span class="fl">1</span> <span class="op">:</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">eusilc</span><span class="op">)</span>, <span class="va">eusilc</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># calculate the gini coefficient</span></span>
<span><span class="co"># using the R vardpoor library</span></span>
<span><span class="va">varpoord_gini_calculation</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/vardpoor/man/varpoord.html" class="external-link">varpoord</a></span><span class="op">(</span></span>
<span>    </span>
<span>        <span class="co"># analysis variable</span></span>
<span>        Y <span class="op">=</span> <span class="st">"eqincome"</span>, </span>
<span>        </span>
<span>        <span class="co"># weights variable</span></span>
<span>        w_final <span class="op">=</span> <span class="st">"rb050"</span>,</span>
<span>        </span>
<span>        <span class="co"># row number variable</span></span>
<span>        ID_level1 <span class="op">=</span> <span class="st">"IDd"</span>,</span>
<span>        </span>
<span>        <span class="co"># row number variable</span></span>
<span>        ID_level2 <span class="op">=</span> <span class="st">"IDd"</span>,</span>
<span>        </span>
<span>        <span class="co"># strata variable</span></span>
<span>        H <span class="op">=</span> <span class="st">"db040"</span>, </span>
<span>        </span>
<span>        N_h <span class="op">=</span> <span class="cn">NULL</span> ,</span>
<span>        </span>
<span>        <span class="co"># clustering variable</span></span>
<span>        PSU <span class="op">=</span> <span class="st">"rb030"</span>, </span>
<span>        </span>
<span>        <span class="co"># data.table</span></span>
<span>        dataset <span class="op">=</span> <span class="va">dati</span>, </span>
<span>        </span>
<span>        <span class="co"># gini coefficient function</span></span>
<span>        type <span class="op">=</span> <span class="st">"lingini"</span>,</span>
<span>      </span>
<span>      <span class="co"># poverty threshold range</span></span>
<span>      order_quant <span class="op">=</span> <span class="fl">50L</span> ,</span>
<span>      </span>
<span>      <span class="co"># get linearized variable</span></span>
<span>      outp_lin <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>        </span>
<span>    <span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="co"># construct a survey.design</span></span>
<span><span class="co"># using our recommended setup</span></span>
<span><span class="va">des_eusilc</span> <span class="op">&lt;-</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/survey/man/svydesign.html" class="external-link">svydesign</a></span><span class="op">(</span> </span>
<span>        ids <span class="op">=</span> <span class="op">~</span> <span class="va">rb030</span> , </span>
<span>        strata <span class="op">=</span> <span class="op">~</span> <span class="va">db040</span> ,  </span>
<span>        weights <span class="op">=</span> <span class="op">~</span> <span class="va">rb050</span> , </span>
<span>        data <span class="op">=</span> <span class="va">eusilc</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="co"># immediately run the convey_prep function on it</span></span>
<span><span class="va">des_eusilc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/convey_prep.html">convey_prep</a></span><span class="op">(</span> <span class="va">des_eusilc</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># coefficients do match</span></span>
<span><span class="va">varpoord_gini_calculation</span><span class="op">$</span><span class="va">all_result</span><span class="op">$</span><span class="va">value</span></span>
<span><span class="co">#&gt; [1] 26.49652</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span> <span class="fu"><a href="../reference/svygini.html">svygini</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">eqincome</span> , <span class="va">des_eusilc</span> <span class="op">)</span> <span class="op">)</span> <span class="op">*</span> <span class="fl">100</span></span>
<span><span class="co">#&gt; eqincome </span></span>
<span><span class="co">#&gt; 26.49652</span></span>
<span></span>
<span><span class="co"># linearized variables do match</span></span>
<span><span class="co"># varpoord</span></span>
<span><span class="va">lin_gini_varpoord</span><span class="op">&lt;-</span> <span class="va">varpoord_gini_calculation</span><span class="op">$</span><span class="va">lin_out</span><span class="op">$</span><span class="va">lin_gini</span></span>
<span><span class="co"># convey </span></span>
<span><span class="va">lin_gini_convey</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span> <span class="fu"><a href="../reference/svygini.html">svygini</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">eqincome</span> , <span class="va">des_eusilc</span> , linearized <span class="op">=</span> <span class="cn">TRUE</span> <span class="op">)</span> , <span class="st">"linearized"</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># check equality</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span> <span class="va">lin_gini_varpoord</span> , <span class="op">(</span> <span class="fl">100</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span> <span class="va">lin_gini_convey</span> <span class="op">)</span> <span class="op">)</span> <span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="co"># variances do not match exactly</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span> <span class="fu"><a href="../reference/svygini.html">svygini</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">eqincome</span> , <span class="va">des_eusilc</span> <span class="op">)</span> , <span class="st">'var'</span> <span class="op">)</span> <span class="op">*</span> <span class="fl">10000</span></span>
<span><span class="co">#&gt;            eqincome</span></span>
<span><span class="co">#&gt; eqincome 0.03790739</span></span>
<span><span class="va">varpoord_gini_calculation</span><span class="op">$</span><span class="va">all_result</span><span class="op">$</span><span class="va">var</span></span>
<span><span class="co">#&gt; [1] 0.03783931</span></span>
<span></span>
<span><span class="co"># standard errors do not match exactly</span></span>
<span><span class="va">varpoord_gini_calculation</span><span class="op">$</span><span class="va">all_result</span><span class="op">$</span><span class="va">se</span></span>
<span><span class="co">#&gt; [1] 0.1945233</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/survey/man/SE.html" class="external-link">SE</a></span><span class="op">(</span> <span class="fu"><a href="../reference/svygini.html">svygini</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">eqincome</span> , <span class="va">des_eusilc</span> <span class="op">)</span> <span class="op">)</span> <span class="op">*</span> <span class="fl">100</span></span>
<span><span class="co">#&gt;           eqincome</span></span>
<span><span class="co">#&gt; eqincome 0.1946982</span></span></code></pre></div>
<p>The variance estimate is computed by using the approximation defined
in @ref(eq:var), where the linearized variable <span class="math inline">\(z\)</span> is defined by @ref(eq:lin). The
functions <code><a href="../reference/svygini.html">convey::svygini</a></code> and
<code><a href="https://rdrr.io/pkg/vardpoor/man/lingini.html" class="external-link">vardpoor::lingini</a></code> produce the same linearized variable
<span class="math inline">\(z\)</span>.</p>
<p>However, the measures of uncertainty do not line up, because
<code><a href="https://csblatvia.github.io/vardpoor/" class="external-link">library(vardpoor)</a></code> defaults to an ultimate cluster method
that can be replicated with an alternative setup of the
<code>survey.design</code> object.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># within each strata, sum up the weights</span></span>
<span><span class="va">cluster_sums</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span> <span class="va">eusilc</span><span class="op">$</span><span class="va">rb050</span> , <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span> <span class="va">eusilc</span><span class="op">$</span><span class="va">db040</span> <span class="op">)</span> , <span class="va">sum</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># name the within-strata sums of weights the `cluster_sum`</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span> <span class="va">cluster_sums</span> <span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="st">"db040"</span> , <span class="st">"cluster_sum"</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># merge this column back onto the data.frame</span></span>
<span><span class="va">eusilc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span> <span class="va">eusilc</span> , <span class="va">cluster_sums</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># construct a survey.design</span></span>
<span><span class="co"># with the fpc using the cluster sum</span></span>
<span><span class="va">des_eusilc_ultimate_cluster</span> <span class="op">&lt;-</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/survey/man/svydesign.html" class="external-link">svydesign</a></span><span class="op">(</span> </span>
<span>        ids <span class="op">=</span> <span class="op">~</span> <span class="va">rb030</span> , </span>
<span>        strata <span class="op">=</span> <span class="op">~</span> <span class="va">db040</span> ,  </span>
<span>        weights <span class="op">=</span> <span class="op">~</span> <span class="va">rb050</span> , </span>
<span>        data <span class="op">=</span> <span class="va">eusilc</span> , </span>
<span>        fpc <span class="op">=</span> <span class="op">~</span> <span class="va">cluster_sum</span> </span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="co"># again, immediately run the convey_prep function on the `survey.design`</span></span>
<span><span class="va">des_eusilc_ultimate_cluster</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/convey_prep.html">convey_prep</a></span><span class="op">(</span> <span class="va">des_eusilc_ultimate_cluster</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># matches</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span> <span class="fu"><a href="../reference/svygini.html">svygini</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">eqincome</span> , <span class="va">des_eusilc_ultimate_cluster</span> <span class="op">)</span> , <span class="st">'var'</span> <span class="op">)</span> <span class="op">*</span> <span class="fl">10000</span></span>
<span><span class="co">#&gt;            eqincome</span></span>
<span><span class="co">#&gt; eqincome 0.03783931</span></span>
<span><span class="va">varpoord_gini_calculation</span><span class="op">$</span><span class="va">all_result</span><span class="op">$</span><span class="va">var</span></span>
<span><span class="co">#&gt; [1] 0.03783931</span></span>
<span></span>
<span><span class="co"># matches</span></span>
<span><span class="va">varpoord_gini_calculation</span><span class="op">$</span><span class="va">all_result</span><span class="op">$</span><span class="va">se</span></span>
<span><span class="co">#&gt; [1] 0.1945233</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/survey/man/SE.html" class="external-link">SE</a></span><span class="op">(</span> <span class="fu"><a href="../reference/svygini.html">svygini</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">eqincome</span> , <span class="va">des_eusilc_ultimate_cluster</span> <span class="op">)</span> <span class="op">)</span> <span class="op">*</span> <span class="fl">100</span></span>
<span><span class="co">#&gt;           eqincome</span></span>
<span><span class="co">#&gt; eqincome 0.1945233</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="zenga-index-svyzenga">Zenga index (svyzenga)<a class="anchor" aria-label="anchor" href="#zenga-index-svyzenga"></a>
</h2>
<p>Proposed by <span class="citation">Zenga (2007)</span>, the Zenga
index is another inequality measure related to the Lorenz curve with
interesting properties. For continuous populations, it is defined
as:</p>
<p><span class="math display">\[
Z = 1 - \int_{0}^{1} \frac{L(p)}{p} \cdot \frac{ 1 - p }{ 1 - L(p) } dp
\]</span></p>
<p>In practice, <code>convey</code> uses the <span class="citation">Barabesi, Diana, and Perri (2016)</span> estimator,
based on the finite population Zenga index, and a variance estimator
derived using Deville’s <span class="citation">(1999)</span> influence
function method.</p>
<p>Alternatively, <span class="citation">Langel and Tillé (2012)</span>
uses an estimator based on smoothed quantiles and a variance estimator
based on <span class="citation">Demnati and Rao (2004)</span>
linearization method. However, <span class="citation">Barabesi, Diana,
and Perri (2016)</span> finds that both estimators behave very
similarly.</p>
<p>The intuition behind the Zenga index is based on argument similar to
the Quintile Share Ratio or Palma index. While the QSR and Palma indices
are based on ratios of bottom and upper shares, the Zenga scores (but
not the measure itself!) is the ratio of bottom and upper means. The
Zenga index is the average of those scores.</p>
<p>For a given p, when the mean income of the poorest is not much
smaller than the mean income of the richest, the ratio is close to one,
resulting in Z(p) close to zero. However, when the bottom mean is much
smaller than the upper mean, the ratio goes to 0, resulting in a Z(p)
close to one.</p>
<p>Take the poorest 20%: the mean income of the poorest 20%, this is the
lower mean. The “complement” is the mean income of the richest 80%: this
is the upper mean. If the lower mean is $100 and the upper mean is
$1,000, then the respective point on the Zenga curve would associate the
fraction 20% to 1 - ( $100 / $1,000 ) = 0.9. In other words, Z(20%) =
90%.</p>
<p>In this case, we took a fixed p = 20%; however, the full Zenga curve
would be computed varying p from 0% to 100%. Then, the Zenga index is
the integral of this curve in the interval (0,1).</p>
<p>Unlike the relationship between the Gini coefficient and the Lorenz
curve, this allows for a more straightforward graphical interpretation
(see Figure 1 from <span class="citation">Langel and Tillé
(2012)</span>) of the Zenga index. In fact, the Zenga index is the mean
of the Y axis of the Zenga coordinates.</p>
<p>According to <span class="citation">Langel and Tillé (2012)</span>,
“the Zenga index is significantly less affected by extreme observations
than the Gini index. This is a very important advantage of the Zenga
index because inference from income data is often confronted with
extreme values.”</p>
<hr>
<p><strong>A replication example</strong></p>
<p>While it is not possible to reproduce the exact results because their
simulation includes random sampling, we can replicate a Monte Carlo
experiment similar to the one presented by <span class="citation">Barabesi, Diana, and Perri (2016)</span> in Table
2.</p>
<p>Load and prepare the data set:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load the convey package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://guilhermejacob.github.io/context/" class="external-link">convey</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># load the survey library</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://r-survey.r-forge.r-project.org/survey/" class="external-link">survey</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create a temporary file on the local disk</span></span>
<span><span class="va">tf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># store the location of the zip file</span></span>
<span><span class="va">data_zip</span> <span class="op">&lt;-</span> <span class="st">"https://www.bancaditalia.it/statistiche/tematiche/indagini-famiglie-imprese/bilanci-famiglie/distribuzione-microdati/documenti/ind12_ascii.zip"</span></span>
<span></span>
<span><span class="co"># download to the temporary file</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span> <span class="va">data_zip</span> , <span class="va">tf</span> , mode <span class="op">=</span> <span class="st">'wb'</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># unzip the contents of the archive to a temporary directory</span></span>
<span><span class="va">td</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span> , <span class="st">"shiw2012"</span> <span class="op">)</span></span>
<span><span class="va">data_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/unzip.html" class="external-link">unzip</a></span><span class="op">(</span> <span class="va">tf</span> , exdir <span class="op">=</span> <span class="va">td</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># load the household, consumption and income from SHIW (2012) survey data</span></span>
<span><span class="va">hhr.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span> <span class="st">"carcom12"</span> , <span class="va">data_files</span> , value <span class="op">=</span> <span class="cn">TRUE</span> <span class="op">)</span> <span class="op">)</span></span>
<span><span class="va">cns.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span> <span class="st">"risfam12"</span> , <span class="va">data_files</span> , value <span class="op">=</span> <span class="cn">TRUE</span> <span class="op">)</span> <span class="op">)</span></span>
<span><span class="va">inc.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span> <span class="st">"rper12"</span> , <span class="va">data_files</span> , value <span class="op">=</span> <span class="cn">TRUE</span> <span class="op">)</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># fixes names</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span> <span class="va">cns.df</span> <span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">tolower</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span> <span class="va">cns.df</span> <span class="op">)</span> <span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># household count should be 8151</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span> <span class="va">hhr.df</span><span class="op">$</span><span class="va">nquest</span> <span class="op">)</span> <span class="op">)</span> <span class="op">==</span> <span class="fl">8151</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># person count should be 20022</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span> <span class="va">hhr.df</span><span class="op">$</span><span class="va">nquest</span> , <span class="st">"-"</span> , <span class="va">hhr.df</span><span class="op">$</span><span class="va">nord</span> <span class="op">)</span> <span class="op">)</span> <span class="op">)</span> <span class="op">==</span> <span class="fl">20022</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># income recipients: should be 12986</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span> <span class="va">hhr.df</span><span class="op">$</span><span class="va">PERC</span> <span class="op">)</span> <span class="op">==</span> <span class="fl">12986</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># combine household roster and income datasets</span></span>
<span><span class="va">pop.df</span> <span class="op">&lt;-</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span> </span>
<span>        <span class="va">hhr.df</span> , </span>
<span>        <span class="va">inc.df</span> , </span>
<span>        by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="st">"nquest"</span> ,<span class="st">"nord"</span> <span class="op">)</span> , </span>
<span>        all.x <span class="op">=</span> <span class="cn">TRUE</span> , </span>
<span>        sort <span class="op">=</span> <span class="cn">FALSE</span> </span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="co"># compute household-level income</span></span>
<span><span class="va">hinc.df</span> <span class="op">&lt;-</span> </span>
<span>    <span class="va">pop.df</span><span class="op">[</span> </span>
<span>        <span class="va">pop.df</span><span class="op">$</span><span class="va">PERC</span> <span class="op">==</span> <span class="fl">1</span> , </span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="st">"nquest"</span> , <span class="st">"nord"</span> , <span class="st">"PERC"</span> , <span class="st">"Y"</span> , <span class="st">"YL"</span> , <span class="st">"YM"</span> , <span class="st">"YT"</span> , <span class="st">"YC"</span> <span class="op">)</span> , </span>
<span>        drop <span class="op">=</span> <span class="cn">FALSE</span> </span>
<span>    <span class="op">]</span></span>
<span>    </span>
<span><span class="va">hinc.df</span> <span class="op">&lt;-</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span> </span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span> </span>
<span>            <span class="va">hinc.df</span><span class="op">[</span> , <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="st">"YL"</span>  , <span class="st">"YM"</span> , <span class="st">"YT"</span>  <span class="op">)</span> , drop <span class="op">=</span> <span class="cn">FALSE</span> <span class="op">]</span> </span>
<span>        <span class="op">)</span> , </span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span> <span class="st">"nquest"</span> <span class="op">=</span> <span class="va">hinc.df</span><span class="op">$</span><span class="va">nquest</span> <span class="op">)</span> , </span>
<span>        <span class="va">sum</span> , </span>
<span>        na.rm <span class="op">=</span> <span class="cn">TRUE</span> </span>
<span>    <span class="op">)</span></span>
<span>    </span>
<span><span class="va">pop.df</span> <span class="op">&lt;-</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span> </span>
<span>        <span class="va">pop.df</span> , </span>
<span>        <span class="va">hinc.df</span> , </span>
<span>        by <span class="op">=</span> <span class="st">"nquest"</span> , </span>
<span>        all.x <span class="op">=</span> <span class="cn">TRUE</span> , </span>
<span>        sort <span class="op">=</span> <span class="cn">FALSE</span> </span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="co"># combine with consumption data</span></span>
<span><span class="va">pop.df</span> <span class="op">&lt;-</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span> </span>
<span>        <span class="va">pop.df</span> , </span>
<span>        <span class="va">cns.df</span> , </span>
<span>        by <span class="op">=</span> <span class="st">"nquest"</span> , </span>
<span>        all.x <span class="op">=</span> <span class="cn">TRUE</span> , </span>
<span>        sort <span class="op">=</span> <span class="cn">FALSE</span> </span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="co"># treat household-level sample as the finite population</span></span>
<span><span class="va">pop.df</span> <span class="op">&lt;-</span> </span>
<span>    <span class="va">pop.df</span><span class="op">[</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span> <span class="va">pop.df</span><span class="op">$</span><span class="va">nquest</span> <span class="op">)</span> , , drop <span class="op">=</span> <span class="cn">FALSE</span> <span class="op">]</span></span></code></pre></div>
<p>For the Monte Carlo experiment, we take <code>5000</code> samples of
(expected) size <code>1000</code> using Poisson sampling<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> and estimate the Zenga
index using each sample:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set up monte carlo attributes</span></span>
<span><span class="va">MC.reps</span> <span class="op">&lt;-</span> <span class="fl">5000L</span></span>
<span><span class="va">n.size</span> <span class="op">=</span> <span class="fl">1000L</span></span>
<span><span class="va">N.size</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span> <span class="va">pop.df</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># calculate first order probabilities</span></span>
<span><span class="va">pop.df</span><span class="op">$</span><span class="va">pik</span> <span class="op">&lt;-</span></span>
<span>    <span class="va">n.size</span> <span class="op">*</span> <span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span> <span class="va">pop.df</span><span class="op">$</span><span class="va">C</span> <span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span> <span class="va">pop.df</span><span class="op">$</span><span class="va">C</span> <span class="op">)</span> <span class="op">)</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># calculate second order probabilities</span></span>
<span><span class="va">pikl</span> <span class="op">&lt;-</span> <span class="va">pop.df</span><span class="op">$</span><span class="va">pik</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span> <span class="va">pop.df</span><span class="op">$</span><span class="va">pik</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span> <span class="va">pikl</span> <span class="op">)</span> <span class="op">&lt;-</span> <span class="va">pop.df</span><span class="op">$</span><span class="va">pik</span> </span>
<span></span>
<span><span class="co"># set random number seed</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span> <span class="fl">1997</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># create list of survey design objects</span></span>
<span><span class="co"># using poisson sampling</span></span>
<span><span class="va">survey.list</span> <span class="op">&lt;-</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span> </span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span> <span class="va">MC.reps</span> <span class="op">)</span> , </span>
<span>        <span class="kw">function</span><span class="op">(</span> <span class="va">this.rep</span> <span class="op">)</span><span class="op">{</span></span>
<span>            <span class="va">smp.ind</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span> <span class="va">N.size</span> <span class="op">)</span> <span class="op">&lt;=</span> <span class="va">pop.df</span><span class="op">$</span><span class="va">pik</span> <span class="op">)</span></span>
<span>            <span class="va">smp.df</span> <span class="op">&lt;-</span> <span class="va">pop.df</span><span class="op">[</span> <span class="va">smp.ind</span> , , drop <span class="op">=</span> <span class="cn">FALSE</span> <span class="op">]</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/survey/man/svydesign.html" class="external-link">svydesign</a></span><span class="op">(</span> </span>
<span>                ids <span class="op">=</span> <span class="op">~</span><span class="va">nquest</span> , </span>
<span>                data <span class="op">=</span> <span class="va">smp.df</span> , </span>
<span>                fpc <span class="op">=</span> <span class="op">~</span><span class="va">pik</span> , </span>
<span>                nest <span class="op">=</span> <span class="cn">FALSE</span> , </span>
<span>                pps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/HR.html" class="external-link">ppsmat</a></span><span class="op">(</span> <span class="va">pikl</span><span class="op">[</span> <span class="va">smp.ind</span> , <span class="va">smp.ind</span> <span class="op">]</span> <span class="op">)</span> , </span>
<span>                variance <span class="op">=</span> <span class="st">"HT"</span> </span>
<span>            <span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="co"># estimate zenga index for each sample</span></span>
<span><span class="va">estimate.list</span> <span class="op">&lt;-</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span></span>
<span>        <span class="va">survey.list</span> , </span>
<span>        <span class="kw">function</span><span class="op">(</span> <span class="va">this.sample</span> <span class="op">)</span><span class="op">{</span></span>
<span>            <span class="fu"><a href="../reference/svyzenga.html">svyzenga</a></span><span class="op">(</span> </span>
<span>                <span class="op">~</span><span class="va">x</span> , </span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span> <span class="va">this.sample</span> , <span class="va">x</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">)</span> , </span>
<span>                na.rm <span class="op">=</span> <span class="cn">TRUE</span> </span>
<span>            <span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>    <span class="op">)</span></span>
<span>    </span></code></pre></div>
<p>Then, we evaluate the Percentage Relative Bias (PRB) of the Zenga
index estimator. Under this scenario, the PRB of the Zenga index
estimator is 0.3397%, a result similar to the <code>0.321</code> shown
in Table 2.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># compute the (finite population) Zenga index parameter</span></span>
<span><span class="va">theta.pop</span> <span class="op">&lt;-</span> <span class="fu">convey</span><span class="fu">:::</span><span class="fu">CalcZenga</span><span class="op">(</span> <span class="va">pop.df</span><span class="op">$</span><span class="va">x</span> , <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span> <span class="va">pop.df</span><span class="op">$</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">0</span> , <span class="fl">1</span> , <span class="fl">0</span> <span class="op">)</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># estimate the expected value of the Zenga index estimator</span></span>
<span><span class="co"># using the average of the estimates</span></span>
<span><span class="va">theta.exp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span> <span class="va">estimate.list</span> , <span class="va">coef</span> <span class="op">)</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># estimate the percentage relative bias</span></span>
<span><span class="fl">100</span> <span class="op">*</span> <span class="op">(</span> <span class="va">theta.exp</span><span class="op">/</span><span class="va">theta.pop</span> <span class="op">-</span> <span class="fl">1</span> <span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.3396837</span></span></code></pre></div>
<p>Then, we evaluate the PRB of the variance estimator of the Zenga
index estimator. Under this scenario, the PRB of the Zenga index
variance estimator is -0.4954%, another result similar to the
<code>-0.600</code> shown in Table 2.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># estimate the variance of the Zenga index estimator</span></span>
<span><span class="co"># using the variance of the estimates</span></span>
<span><span class="op">(</span> <span class="va">vartheta.popest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span> <span class="va">estimate.list</span> , <span class="va">coef</span> <span class="op">)</span> <span class="op">)</span> <span class="op">)</span></span>
<span><span class="co">#&gt; [1] 9.47244e-05</span></span>
<span></span>
<span><span class="co"># estimate the expected value of the Zenga index variance estimator</span></span>
<span><span class="co"># using the expected of the variance estimates</span></span>
<span><span class="op">(</span> <span class="va">vartheta.exp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span> <span class="va">estimate.list</span> , <span class="va">vcov</span> <span class="op">)</span> <span class="op">)</span> <span class="op">)</span></span>
<span><span class="co">#&gt; [1] 9.425515e-05</span></span>
<span></span>
<span><span class="co"># estimate the percentage relative bias</span></span>
<span><span class="fl">100</span> <span class="op">*</span> <span class="op">(</span> <span class="va">vartheta.exp</span><span class="op">/</span><span class="va">vartheta.popest</span> <span class="op">-</span> <span class="fl">1</span> <span class="op">)</span></span>
<span><span class="co">#&gt; [1] -0.4953863</span></span></code></pre></div>
<p>Next, we evaluate the Percentage Coverage Rate (PCR). In theory,
under repeated sampling, the estimated 95% CIs should cover the
population parameter 95% of the time. We can evaluate that using:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># estimate confidence intervals of the Zenga index</span></span>
<span><span class="co"># for each of the samples</span></span>
<span><span class="va">est.cis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span> <span class="va">estimate.list</span>, <span class="kw">function</span><span class="op">(</span> <span class="va">this.stat</span> <span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span> <span class="va">this.stat</span> <span class="op">)</span> <span class="op">)</span> <span class="op">)</span> <span class="op">)</span> </span>
<span></span>
<span><span class="co"># evaluate</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/proportions.html" class="external-link">prop.table</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span> <span class="op">(</span> <span class="va">theta.pop</span> <span class="op">&gt;</span> <span class="va">est.cis</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span> <span class="va">theta.pop</span> <span class="op">&lt;</span> <span class="va">est.cis</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">)</span> <span class="op">)</span> <span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  FALSE   TRUE </span></span>
<span><span class="co">#&gt; 0.0548 0.9452</span></span></code></pre></div>
<p>Our estimated 95% CIs cover the parameter 94.52% of the time, which
is very close to the nominal rate and also similar to the
<code>94.5</code> PCR shown in Table 2.</p>
</div>
<div class="section level2">
<h2 id="entropy-based-measures">Entropy-based Measures<a class="anchor" aria-label="anchor" href="#entropy-based-measures"></a>
</h2>
<p>Entropy is a concept derived from information theory, meaning the
expected amount of information given the occurrence of an event.
Following <span class="citation">(Shannon 1948)</span>, given an event
<span class="math inline">\(y\)</span> with probability density function
<span class="math inline">\(f(\cdot)\)</span>, the information content
given the occurrence of <span class="math inline">\(y\)</span> can be
defined as <span class="math inline">\(g(f(y)) \colon= - \log
f(y)\)</span>. Therefore, the expected information or, put simply, the
<em>entropy</em> is</p>
<p><span class="math display">\[
H(f) \colon = -E \big[ \log f(y) \big] = - \int_{-\infty}^{\infty} f(y)
\log f(y) dy
\]</span></p>
<p>Assuming a discrete distribution, with <span class="math inline">\(p_k\)</span> as the probability of occurring event
<span class="math inline">\(k \in K\)</span>, the entropy formula takes
the form:</p>
<p><span class="math display">\[
H = - \sum_{k \in K} p_k \log p_k \text{.}
\]</span></p>
<p>The main idea behind it is that the expected amount of information of
an event is inversely proportional to the probability of its occurrence.
In other words, the information derived from the observation of a rare
event is higher than of the information of more probable events.</p>
<p>Using ideas presented in <span class="citation">Frank A. Cowell,
Flachaire, and Bandyopadhyay (2009)</span>, substituting the density
function by the income share of an individual <span class="math inline">\(s(q) = {F}^{-1}(q) / \int_{0}^{1} F^{-1}(t)dt =
y/\mu\)</span>, the entropy function becomes the Theil<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a> inequality index</p>
<p><span class="math display">\[
I_{Theil} = \int_{0}^{\infty} \frac{y}{\mu} \log \bigg( \frac{y}{\mu}
\bigg) dF(y) = -H(s)
\]</span></p>
<p>Therefore, the entropy-based inequality measure increases as a
person’s income <span class="math inline">\(y\)</span> deviates from the
mean <span class="math inline">\(\mu\)</span>. This is the basic idea
behind entropy-based inequality measures.</p>
</div>
<div class="section level2">
<h2 id="generalized-entropy-and-decomposition-svygei-svygeidec">Generalized Entropy and Decomposition (svygei, svygeidec)<a class="anchor" aria-label="anchor" href="#generalized-entropy-and-decomposition-svygei-svygeidec"></a>
</h2>
<p>Using a generalization of the information function, now defined as
<span class="math inline">\(g(f) = \frac{1}{\alpha-1} [ 1 - f^{\alpha -
1} ]\)</span>, the <span class="math inline">\(\alpha\)</span>-class
entropy is <span class="math display">\[
H^{(\alpha)} (f) = \frac{1}{\alpha - 1} \bigg[ 1 -
\int_{-\infty}^{\infty} f(y)^{ \alpha - 1} f(y) dy \bigg] \text{.}
\]</span></p>
<p>This relates to a class of inequality measures, the Generalized
entropy indices, defined as:</p>
<p><span class="math display">\[
GE^{(\alpha)} = \frac{1}{\alpha^2 - \alpha} \int_{0}^\infty \bigg[
\bigg( \frac{y}{\mu} \bigg)^\alpha - 1 \bigg]dF(x) = -
\frac{-H_\alpha(s) }{ \alpha } \text{.}
\]</span></p>
<p>The parameter <span class="math inline">\(\alpha\)</span> also has an
economic interpretation: as <span class="math inline">\(\alpha\)</span>
increases, the influence of top incomes upon the index increases. In
some cases, this measure takes special forms, such as mean log deviation
and the aforementioned Theil index.</p>
<p><span class="citation">Biewen and Jenkins (2003)</span> use the
following finite-population as the basis for a plugin estimator:</p>
<p><span class="math display">\[
GE^{(\alpha)} =
\begin{cases}
( \alpha^2 - \alpha)^{-1} \big[ U_0^{\alpha - 1} U_1^{-\alpha} U_\alpha
-1 \big], &amp; \text{if } \alpha \in \mathbb{R} \setminus \{0,1\} \\
- T_0 U_0^{-1} + \log ( U_1 / U_0 ), &amp;\text{if } \alpha \rightarrow
0 \\
T_1 U_1^{-1} - \log ( U_1 / U_0 ), &amp; \text{if } \alpha \rightarrow 1
\end{cases}
\]</span></p>
<p>where <span class="math inline">\(U_\gamma = \sum_{i \in U}
y_i^\gamma\)</span> and <span class="math inline">\(T_\gamma = \sum_{i
\in U} y_i^\gamma \log y_i\)</span>. Since those are all functions of
totals, the linearization of the indices are easily achieved using the
theorems described in <span class="citation">Deville (1999)</span>.</p>
<p>This class also has several desirable properties, such as additive
decomposition. The additive decomposition allows to compare the effects
of inequality within and between population groups on the population
inequality. Put simply, taking <span class="math inline">\(G\)</span>
groups, an additive decomposable index allows for:</p>
<p><span class="math display">\[
\begin{aligned}
I ( \mathbf{y} ) &amp;= I_{Within} + I_{Between} \\
\end{aligned}
\]</span></p>
<p>where <span class="math inline">\(I_{Within} = \sum_{g \in G} W_g I(
\mathbf{y}_g )\)</span>, with <span class="math inline">\(W_g\)</span>
being measure-specific group weights; and <span class="math inline">\(I_{Between}\)</span> is a function of the group
means and population sizes.</p>
<hr>
<p><strong>A replication example</strong></p>
<p>In July 2006, <span class="citation">Jenkins (2008)</span> presented
at the North American Stata Users’ Group Meetings on the stata
Generalized Entropy Index command. The example below reproduces those
statistics.</p>
<p>Load and prepare the same data set:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load the convey package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://guilhermejacob.github.io/context/" class="external-link">convey</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># load the survey library</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://r-survey.r-forge.r-project.org/survey/" class="external-link">survey</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># load the foreign library</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://svn.r-project.org/R-packages/trunk/foreign/" class="external-link">foreign</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create a temporary file on the local disk</span></span>
<span><span class="va">tf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># store the location of the presentation file</span></span>
<span><span class="va">presentation_zip</span> <span class="op">&lt;-</span> <span class="st">"http://repec.org/nasug2006/nasug2006_jenkins.zip"</span></span>
<span></span>
<span><span class="co"># download jenkins' presentation to the temporary file</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span> <span class="va">presentation_zip</span> , <span class="va">tf</span> , mode <span class="op">=</span> <span class="st">'wb'</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># unzip the contents of the archive</span></span>
<span><span class="va">presentation_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/unzip.html" class="external-link">unzip</a></span><span class="op">(</span> <span class="va">tf</span> , exdir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># load the institute for fiscal studies' 1981, 1985, and 1991 data.frame objects</span></span>
<span><span class="va">x81</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/foreign/man/read.dta.html" class="external-link">read.dta</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span> <span class="st">"ifs81"</span> , <span class="va">presentation_files</span> , value <span class="op">=</span> <span class="cn">TRUE</span> <span class="op">)</span> <span class="op">)</span></span>
<span><span class="va">x85</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/foreign/man/read.dta.html" class="external-link">read.dta</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span> <span class="st">"ifs85"</span> , <span class="va">presentation_files</span> , value <span class="op">=</span> <span class="cn">TRUE</span> <span class="op">)</span> <span class="op">)</span></span>
<span><span class="va">x91</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/foreign/man/read.dta.html" class="external-link">read.dta</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span> <span class="st">"ifs91"</span> , <span class="va">presentation_files</span> , value <span class="op">=</span> <span class="cn">TRUE</span> <span class="op">)</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># stack each of these three years of data into a single data.frame</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span> <span class="va">x81</span> , <span class="va">x85</span> , <span class="va">x91</span> <span class="op">)</span></span></code></pre></div>
<p>Replicate the author’s survey design statement from stata code..</p>
<pre><code>. * account for clustering within HHs 
. version 8: svyset [pweight = wgt], psu(hrn)
pweight is wgt
psu is hrn
construct an</code></pre>
<p>.. into R code:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># initiate a linearized survey design object</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/svydesign.html" class="external-link">svydesign</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">hrn</span> , data <span class="op">=</span> <span class="va">x</span> , weights <span class="op">=</span> <span class="op">~</span> <span class="va">wgt</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># immediately run the `convey_prep` function on the survey design</span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/convey_prep.html">convey_prep</a></span><span class="op">(</span> <span class="va">y</span> <span class="op">)</span></span></code></pre></div>
<p>Replicate the author’s subset statement and each of his svygei
results..</p>
<pre><code>. svygei x if year == 1981
 
Warning: x has 20 values = 0. Not used in calculations

Complex survey estimates of Generalized Entropy inequality indices
 
pweight: wgt                                   Number of obs    = 9752
Strata: &lt;one&gt;                                  Number of strata = 1
PSU: hrn                                       Number of PSUs   = 7459
                                               Population size  = 54766261
---------------------------------------------------------------------------
Index    |  Estimate   Std. Err.      z      P&gt;|z|     [95% Conf. Interval]
---------+-----------------------------------------------------------------
GE(-1)   |  .1902062   .02474921     7.69    0.000      .1416987   .2387138
MLD      |  .1142851   .00275138    41.54    0.000      .1088925   .1196777
Theil    |  .1116923   .00226489    49.31    0.000      .1072532   .1161314
GE(2)    |   .128793   .00330774    38.94    0.000      .1223099    .135276
GE(3)    |  .1739994   .00662015    26.28    0.000      .1610242   .1869747
---------------------------------------------------------------------------</code></pre>
<p>..using R code:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">z81</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span> <span class="va">z</span> , <span class="va">year</span> <span class="op">==</span> <span class="fl">1981</span> <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/svygei.html">svygei</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">eybhc0</span> , <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span> <span class="va">z81</span> , <span class="va">eybhc0</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">)</span> , epsilon <span class="op">=</span> <span class="op">-</span><span class="fl">1</span> <span class="op">)</span></span>
<span><span class="co">#&gt;            gei     SE</span></span>
<span><span class="co">#&gt; eybhc0 0.19021 0.0247</span></span>
<span><span class="fu"><a href="../reference/svygei.html">svygei</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">eybhc0</span> , <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span> <span class="va">z81</span> , <span class="va">eybhc0</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">)</span> , epsilon <span class="op">=</span> <span class="fl">0</span> <span class="op">)</span></span>
<span><span class="co">#&gt;            gei     SE</span></span>
<span><span class="co">#&gt; eybhc0 0.11429 0.0028</span></span>
<span><span class="fu"><a href="../reference/svygei.html">svygei</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">eybhc0</span> , <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span> <span class="va">z81</span> , <span class="va">eybhc0</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">)</span> <span class="op">)</span></span>
<span><span class="co">#&gt;            gei     SE</span></span>
<span><span class="co">#&gt; eybhc0 0.11169 0.0023</span></span>
<span><span class="fu"><a href="../reference/svygei.html">svygei</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">eybhc0</span> , <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span> <span class="va">z81</span> , <span class="va">eybhc0</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">)</span> , epsilon <span class="op">=</span> <span class="fl">2</span> <span class="op">)</span></span>
<span><span class="co">#&gt;            gei     SE</span></span>
<span><span class="co">#&gt; eybhc0 0.12879 0.0033</span></span>
<span><span class="fu"><a href="../reference/svygei.html">svygei</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">eybhc0</span> , <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span> <span class="va">z81</span> , <span class="va">eybhc0</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">)</span> , epsilon <span class="op">=</span> <span class="fl">3</span> <span class="op">)</span></span>
<span><span class="co">#&gt;          gei     SE</span></span>
<span><span class="co">#&gt; eybhc0 0.174 0.0066</span></span></code></pre></div>
<p>Confirm this replication applies for subsetted objects as well.
Compare stata output..</p>
<pre><code>. svygei x if year == 1985 &amp; x &gt;= 1

Complex survey estimates of Generalized Entropy inequality indices
 
pweight: wgt                                   Number of obs    = 8969
Strata: &lt;one&gt;                                  Number of strata = 1
PSU: hrn                                       Number of PSUs   = 6950
                                               Population size  = 55042871
---------------------------------------------------------------------------
Index    |  Estimate   Std. Err.      z      P&gt;|z|     [95% Conf. Interval]
---------+-----------------------------------------------------------------
GE(-1)   |  .1602358   .00936931    17.10    0.000      .1418723   .1785993
MLD      |   .127616   .00332187    38.42    0.000      .1211052   .1341267
Theil    |  .1337177   .00406302    32.91    0.000      .1257543    .141681
GE(2)    |  .1676393   .00730057    22.96    0.000      .1533304   .1819481
GE(3)    |  .2609507   .01850689    14.10    0.000      .2246779   .2972235
---------------------------------------------------------------------------</code></pre>
<p>..to R code:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">z85</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span> <span class="va">z</span> , <span class="va">year</span> <span class="op">==</span> <span class="fl">1985</span> <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/svygei.html">svygei</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">eybhc0</span> , <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span> <span class="va">z85</span> , <span class="va">eybhc0</span> <span class="op">&gt;</span> <span class="fl">1</span> <span class="op">)</span> , epsilon <span class="op">=</span> <span class="op">-</span><span class="fl">1</span> <span class="op">)</span></span>
<span><span class="co">#&gt;            gei     SE</span></span>
<span><span class="co">#&gt; eybhc0 0.16024 0.0094</span></span>
<span><span class="fu"><a href="../reference/svygei.html">svygei</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">eybhc0</span> , <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span> <span class="va">z85</span> , <span class="va">eybhc0</span> <span class="op">&gt;</span> <span class="fl">1</span> <span class="op">)</span> , epsilon <span class="op">=</span> <span class="fl">0</span> <span class="op">)</span></span>
<span><span class="co">#&gt;            gei     SE</span></span>
<span><span class="co">#&gt; eybhc0 0.12762 0.0033</span></span>
<span><span class="fu"><a href="../reference/svygei.html">svygei</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">eybhc0</span> , <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span> <span class="va">z85</span> , <span class="va">eybhc0</span> <span class="op">&gt;</span> <span class="fl">1</span> <span class="op">)</span> <span class="op">)</span></span>
<span><span class="co">#&gt;            gei     SE</span></span>
<span><span class="co">#&gt; eybhc0 0.13372 0.0041</span></span>
<span><span class="fu"><a href="../reference/svygei.html">svygei</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">eybhc0</span> , <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span> <span class="va">z85</span> , <span class="va">eybhc0</span> <span class="op">&gt;</span> <span class="fl">1</span> <span class="op">)</span> , epsilon <span class="op">=</span> <span class="fl">2</span> <span class="op">)</span></span>
<span><span class="co">#&gt;            gei     SE</span></span>
<span><span class="co">#&gt; eybhc0 0.16764 0.0073</span></span>
<span><span class="fu"><a href="../reference/svygei.html">svygei</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">eybhc0</span> , <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span> <span class="va">z85</span> , <span class="va">eybhc0</span> <span class="op">&gt;</span> <span class="fl">1</span> <span class="op">)</span> , epsilon <span class="op">=</span> <span class="fl">3</span> <span class="op">)</span></span>
<span><span class="co">#&gt;            gei     SE</span></span>
<span><span class="co">#&gt; eybhc0 0.26095 0.0185</span></span></code></pre></div>
<p>Replicate the author’s decomposition by population subgroup (work
status) shown on PDF page 57..</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># define work status (PDF page 22)</span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span> <span class="va">z</span> , wkstatus <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="fl">1</span> , <span class="fl">1</span> , <span class="fl">1</span> , <span class="fl">1</span> , <span class="fl">2</span> , <span class="fl">3</span> , <span class="fl">2</span> , <span class="fl">2</span> <span class="op">)</span><span class="op">[</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span> <span class="va">esbu</span> <span class="op">)</span> <span class="op">]</span> <span class="op">)</span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span> <span class="va">z</span> , wkstatus <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span> <span class="va">wkstatus</span> , labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="st">"1+ ft working"</span> , <span class="st">"no ft working"</span> , <span class="st">"elderly"</span> <span class="op">)</span> <span class="op">)</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># subset to 1991 and remove records with zero income</span></span>
<span><span class="va">z91</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span> <span class="va">z</span> , <span class="va">year</span> <span class="op">==</span> <span class="fl">1991</span> <span class="op">&amp;</span> <span class="va">eybhc0</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># population share</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/survey/man/surveysummary.html" class="external-link">svymean</a></span><span class="op">(</span> <span class="op">~</span><span class="va">wkstatus</span>, <span class="va">z91</span> <span class="op">)</span></span>
<span><span class="co">#&gt;                          mean     SE</span></span>
<span><span class="co">#&gt; wkstatus1+ ft working 0.61724 0.0067</span></span>
<span><span class="co">#&gt; wkstatusno ft working 0.20607 0.0059</span></span>
<span><span class="co">#&gt; wkstatuselderly       0.17669 0.0046</span></span>
<span></span>
<span><span class="co"># mean</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/survey/man/svyby.html" class="external-link">svyby</a></span><span class="op">(</span> <span class="op">~</span><span class="va">eybhc0</span>, <span class="op">~</span><span class="va">wkstatus</span>, <span class="va">z91</span>, <span class="va">svymean</span> <span class="op">)</span></span>
<span><span class="co">#&gt;                    wkstatus   eybhc0       se</span></span>
<span><span class="co">#&gt; 1+ ft working 1+ ft working 278.8040 3.703790</span></span>
<span><span class="co">#&gt; no ft working no ft working 151.6317 3.153968</span></span>
<span><span class="co">#&gt; elderly             elderly 176.6045 4.661740</span></span>
<span></span>
<span><span class="co"># subgroup indices: ge_k</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/survey/man/svyby.html" class="external-link">svyby</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">eybhc0</span> , <span class="op">~</span><span class="va">wkstatus</span> , <span class="va">z91</span> , <span class="va">svygei</span> , epsilon <span class="op">=</span> <span class="op">-</span><span class="fl">1</span> <span class="op">)</span></span>
<span><span class="co">#&gt;                    wkstatus     eybhc0          se</span></span>
<span><span class="co">#&gt; 1+ ft working 1+ ft working  0.2300708  0.02853959</span></span>
<span><span class="co">#&gt; no ft working no ft working 10.9231761 10.65482557</span></span>
<span><span class="co">#&gt; elderly             elderly  0.1932164  0.02571991</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/survey/man/svyby.html" class="external-link">svyby</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">eybhc0</span> , <span class="op">~</span><span class="va">wkstatus</span> , <span class="va">z91</span> , <span class="va">svygei</span> , epsilon <span class="op">=</span> <span class="fl">0</span> <span class="op">)</span></span>
<span><span class="co">#&gt;                    wkstatus    eybhc0          se</span></span>
<span><span class="co">#&gt; 1+ ft working 1+ ft working 0.1536921 0.006955506</span></span>
<span><span class="co">#&gt; no ft working no ft working 0.1836835 0.014740510</span></span>
<span><span class="co">#&gt; elderly             elderly 0.1653658 0.016409770</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/survey/man/svyby.html" class="external-link">svyby</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">eybhc0</span> , <span class="op">~</span><span class="va">wkstatus</span> , <span class="va">z91</span> , <span class="va">svygei</span> , epsilon <span class="op">=</span> <span class="fl">1</span> <span class="op">)</span></span>
<span><span class="co">#&gt;                    wkstatus    eybhc0          se</span></span>
<span><span class="co">#&gt; 1+ ft working 1+ ft working 0.1598558 0.008327994</span></span>
<span><span class="co">#&gt; no ft working no ft working 0.1889909 0.016766120</span></span>
<span><span class="co">#&gt; elderly             elderly 0.2023862 0.027787224</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/survey/man/svyby.html" class="external-link">svyby</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">eybhc0</span> , <span class="op">~</span><span class="va">wkstatus</span> , <span class="va">z91</span> , <span class="va">svygei</span> , epsilon <span class="op">=</span> <span class="fl">2</span> <span class="op">)</span></span>
<span><span class="co">#&gt;                    wkstatus    eybhc0         se</span></span>
<span><span class="co">#&gt; 1+ ft working 1+ ft working 0.2130664 0.01546521</span></span>
<span><span class="co">#&gt; no ft working no ft working 0.2846345 0.06016394</span></span>
<span><span class="co">#&gt; elderly             elderly 0.3465088 0.07362898</span></span>
<span></span>
<span><span class="co"># GE decomposition</span></span>
<span><span class="fu"><a href="../reference/svygeidec.html">svygeidec</a></span><span class="op">(</span> <span class="op">~</span><span class="va">eybhc0</span>, <span class="op">~</span><span class="va">wkstatus</span>, <span class="va">z91</span>, epsilon <span class="op">=</span> <span class="op">-</span><span class="fl">1</span> <span class="op">)</span></span>
<span><span class="co">#&gt;         gei decomposition     SE</span></span>
<span><span class="co">#&gt; total            3.682893 3.3999</span></span>
<span><span class="co">#&gt; within           3.646572 3.3998</span></span>
<span><span class="co">#&gt; between          0.036321 0.0028</span></span>
<span><span class="fu"><a href="../reference/svygeidec.html">svygeidec</a></span><span class="op">(</span> <span class="op">~</span><span class="va">eybhc0</span>, <span class="op">~</span><span class="va">wkstatus</span>, <span class="va">z91</span>, epsilon <span class="op">=</span> <span class="fl">0</span> <span class="op">)</span></span>
<span><span class="co">#&gt;         gei decomposition     SE</span></span>
<span><span class="co">#&gt; total            0.195236 0.0065</span></span>
<span><span class="co">#&gt; within           0.161935 0.0061</span></span>
<span><span class="co">#&gt; between          0.033301 0.0025</span></span>
<span><span class="fu"><a href="../reference/svygeidec.html">svygeidec</a></span><span class="op">(</span> <span class="op">~</span><span class="va">eybhc0</span>, <span class="op">~</span><span class="va">wkstatus</span>, <span class="va">z91</span>, epsilon <span class="op">=</span> <span class="fl">1</span> <span class="op">)</span></span>
<span><span class="co">#&gt;         gei decomposition     SE</span></span>
<span><span class="co">#&gt; total            0.200390 0.0079</span></span>
<span><span class="co">#&gt; within           0.169396 0.0076</span></span>
<span><span class="co">#&gt; between          0.030994 0.0022</span></span>
<span><span class="fu"><a href="../reference/svygeidec.html">svygeidec</a></span><span class="op">(</span> <span class="op">~</span><span class="va">eybhc0</span>, <span class="op">~</span><span class="va">wkstatus</span>, <span class="va">z91</span>, epsilon <span class="op">=</span> <span class="fl">2</span> <span class="op">)</span></span>
<span><span class="co">#&gt;         gei decomposition     SE</span></span>
<span><span class="co">#&gt; total            0.274325 0.0167</span></span>
<span><span class="co">#&gt; within           0.245067 0.0164</span></span>
<span><span class="co">#&gt; between          0.029258 0.0021</span></span></code></pre></div>
<p>For additional usage examples of <code>svygei</code> or
<code>svygeidec</code>, type <code><a href="../reference/svygei.html">?convey::svygei</a></code> or
<code><a href="../reference/svygeidec.html">?convey::svygeidec</a></code> in the R console.</p>
</div>
<div class="section level2">
<h2 id="j-divergence-and-decomposition-svyjdiv-svyjdivdec">J-Divergence and Decomposition (svyjdiv, svyjdivdec)<a class="anchor" aria-label="anchor" href="#j-divergence-and-decomposition-svyjdiv-svyjdivdec"></a>
</h2>
<p>The J-divergence measure <span class="citation">(Rohde 2016)</span>
can be seen as the sum of <span class="math inline">\(GE_0\)</span> and
<span class="math inline">\(GE_1\)</span>, satisfying axioms that,
individually, those two indices do not. The J-divergence measure is
defined as</p>
<p><span class="math display">\[
J = \frac{1}{N} \sum_{i \in U} \bigg( \frac{ y_i }{ \mu } -1 \bigg) \ln
\bigg( \frac{y_i}{\mu} \bigg)
\]</span></p>
<p>Since it is a sum of two additive decomposable measures, <span class="math inline">\(J\)</span> itself is decomposable. The within and
between parts of the J-divergence decomposition are</p>
<p><span class="math display">\[
\begin{aligned}
J_B &amp;= \sum_{g \in G} \frac{N_g}{N} \bigg( \frac{ \mu_g }{ \mu } - 1
\bigg) \ln \bigg( \frac{\mu_g}{\mu} \bigg) \\
J_W &amp;= \sum_{g \in G} \bigg[ \frac{Y_g}{Y} GE^{(1)}_g +
\frac{N_g}{N} GE^{(0)}_g  \bigg] = \sum_{g \in G} \bigg[ \bigg(
\frac{Y_g N + YN_g}{YN} \bigg) J_g  \bigg] -
\sum_{g \in G} \bigg[ \frac{Y_g}{Y} GE^{(1)}_g + \frac{N_g}{N}
GE^{(0)}_g  \bigg] \end{aligned}
\]</span></p>
<p>where the subscript <span class="math inline">\(g\)</span> denotes
one of the <span class="math inline">\(G\)</span> subgroups in the
population. The main difference with the additively decomposable
Generalized Entropy family is that the within component of the
J-divergence index cannot be seen as a weighted contribution of the
J-divergence across groups. So <span class="math inline">\(J_W\)</span>
cannot be interpreted as a weighted mean of the J-divergence across
groups, but as the sum of two terms: (1) the income-share weighted mean
of the <span class="math inline">\(GE^{(1)}\)</span> across groups; (2)
and the population-share weighted mean of the <span class="math inline">\(GE^{(0)}\)</span> across groups. In other words,
the “within” component still accounts for the inequality in each group;
it just does not have a direct interpretation.</p>
<hr>
<p><strong>A replication example</strong></p>
<p>First, we should check that the finite-population values make sense.
The J-divergence can be seen as the sum of <span class="math inline">\(GE^{(0)}\)</span> and <span class="math inline">\(GE^{(1)}\)</span>. So, taking the population from
the <code>svyzenga</code> section, we have:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># compute finite population J-divergence</span></span>
<span><span class="op">(</span> <span class="va">jdivt.pop</span> <span class="op">&lt;-</span> <span class="op">(</span> <span class="fu">convey</span><span class="fu">:::</span><span class="fu">CalcJDiv</span><span class="op">(</span> <span class="va">pop.df</span><span class="op">$</span><span class="va">x</span> , <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span> <span class="va">pop.df</span><span class="op">$</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">0</span> , <span class="fl">1</span> , <span class="fl">0</span> <span class="op">)</span> <span class="op">)</span> <span class="op">)</span> <span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.4332649</span></span>
<span></span>
<span><span class="co"># compute finite population GE indices</span></span>
<span><span class="op">(</span> <span class="va">gei0.pop</span> <span class="op">&lt;-</span> <span class="fu">convey</span><span class="fu">:::</span><span class="fu">CalcGEI</span><span class="op">(</span> <span class="va">pop.df</span><span class="op">$</span><span class="va">x</span> , <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span> <span class="va">pop.df</span><span class="op">$</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">0</span> , <span class="fl">1</span> , <span class="fl">0</span> <span class="op">)</span> , <span class="fl">0</span> <span class="op">)</span> <span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.2215037</span></span>
<span><span class="op">(</span> <span class="va">gei1.pop</span> <span class="op">&lt;-</span><span class="fu">convey</span><span class="fu">:::</span><span class="fu">CalcGEI</span><span class="op">(</span> <span class="va">pop.df</span><span class="op">$</span><span class="va">x</span> , <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span> <span class="va">pop.df</span><span class="op">$</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">0</span> , <span class="fl">1</span> , <span class="fl">0</span> <span class="op">)</span> , <span class="fl">1</span> <span class="op">)</span> <span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.2117612</span></span>
<span></span>
<span><span class="co"># check equality; should be true</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span> <span class="va">jdivt.pop</span> , <span class="va">gei0.pop</span> <span class="op">+</span> <span class="va">gei1.pop</span> <span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>As expected, the J-divergence matches the sum of GEs in the finite
population. And as we’ve checked the GE measures before, the
J-divergence computation function seems safe.</p>
<p>In order to assess the estimators implemented in <code>svyjdiv</code>
and <code>svyjdivdec</code>, we can run a Monte Carlo experiment. Using
the same samples we used in the <code>svyzenga</code> replication
example, we have:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># estimate J-divergence with each sample</span></span>
<span><span class="va">estimate.list</span> <span class="op">&lt;-</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span></span>
<span>        <span class="va">survey.list</span> , </span>
<span>        <span class="kw">function</span><span class="op">(</span> <span class="va">this.sample</span> <span class="op">)</span><span class="op">{</span></span>
<span>            <span class="fu"><a href="../reference/svyjdiv.html">svyjdiv</a></span><span class="op">(</span> </span>
<span>                <span class="op">~</span><span class="va">x</span> , </span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span> <span class="va">this.sample</span> , <span class="va">x</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">)</span> , </span>
<span>                na.rm <span class="op">=</span> <span class="cn">TRUE</span> </span>
<span>            <span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="co"># compute the (finite population overall) J-divergence</span></span>
<span><span class="op">(</span> <span class="va">theta.pop</span> <span class="op">&lt;-</span> <span class="fu">convey</span><span class="fu">:::</span><span class="fu">CalcJDiv</span><span class="op">(</span> <span class="va">pop.df</span><span class="op">$</span><span class="va">x</span> , <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span> <span class="va">pop.df</span><span class="op">$</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">0</span> , <span class="fl">1</span> , <span class="fl">0</span> <span class="op">)</span> <span class="op">)</span> <span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.4332649</span></span>
<span></span>
<span><span class="co"># estimate the expected value of the J-divergence estimator</span></span>
<span><span class="co"># using the average of the estimates</span></span>
<span><span class="op">(</span> <span class="va">theta.exp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span> <span class="va">estimate.list</span> , <span class="va">coef</span> <span class="op">)</span> <span class="op">)</span> <span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.4327823</span></span>
<span></span>
<span><span class="co"># estimate the percentage relative bias</span></span>
<span><span class="fl">100</span> <span class="op">*</span> <span class="op">(</span> <span class="va">theta.exp</span><span class="op">/</span><span class="va">theta.pop</span> <span class="op">-</span> <span class="fl">1</span> <span class="op">)</span></span>
<span><span class="co">#&gt; [1] -0.1113765</span></span></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># estimate the variance of the J-divergence estimator</span></span>
<span><span class="co"># using the variance of the estimates</span></span>
<span><span class="op">(</span> <span class="va">vartheta.popest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span> <span class="va">estimate.list</span> , <span class="va">coef</span> <span class="op">)</span> <span class="op">)</span> <span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.0005434848</span></span>
<span></span>
<span><span class="co"># estimate the expected value of the J-divergence index variance estimator</span></span>
<span><span class="co"># using the expected of the variance estimates</span></span>
<span><span class="op">(</span> <span class="va">vartheta.exp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span> <span class="va">estimate.list</span> , <span class="va">vcov</span> <span class="op">)</span> <span class="op">)</span> <span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.0005342947</span></span>
<span></span>
<span><span class="co"># estimate the percentage relative bias of the variance estimator</span></span>
<span><span class="fl">100</span> <span class="op">*</span> <span class="op">(</span> <span class="va">vartheta.exp</span><span class="op">/</span><span class="va">vartheta.popest</span> <span class="op">-</span> <span class="fl">1</span> <span class="op">)</span></span>
<span><span class="co">#&gt; [1] -1.690964</span></span></code></pre></div>
<p>For the decomposition, we repeat the same procedure:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># estimate J-divergence decomposition with each sample</span></span>
<span><span class="va">estimate.list</span> <span class="op">&lt;-</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span></span>
<span>        <span class="va">survey.list</span> , </span>
<span>        <span class="kw">function</span><span class="op">(</span> <span class="va">this.sample</span> <span class="op">)</span><span class="op">{</span></span>
<span>            <span class="fu"><a href="../reference/svyjdivdec.html">svyjdivdec</a></span><span class="op">(</span> </span>
<span>                <span class="op">~</span><span class="va">x</span> , </span>
<span>                <span class="op">~</span><span class="va">SEX</span> ,</span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span> <span class="va">this.sample</span> , <span class="va">x</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">)</span> , </span>
<span>                na.rm <span class="op">=</span> <span class="cn">TRUE</span> </span>
<span>            <span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="co"># compute the (finite population) J-divergence decomposition per sex</span></span>
<span><span class="va">jdivt.pop</span> <span class="op">&lt;-</span> <span class="fu">convey</span><span class="fu">:::</span><span class="fu">CalcJDiv</span><span class="op">(</span> <span class="va">pop.df</span><span class="op">$</span><span class="va">x</span> , <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span> <span class="va">pop.df</span><span class="op">$</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">0</span> , <span class="fl">1</span> , <span class="fl">0</span> <span class="op">)</span> <span class="op">)</span></span>
<span><span class="va">overall.mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span> <span class="va">pop.df</span><span class="op">$</span><span class="va">x</span><span class="op">[</span> <span class="va">pop.df</span><span class="op">$</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">]</span> <span class="op">)</span></span>
<span><span class="va">group.mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/by.html" class="external-link">by</a></span><span class="op">(</span> <span class="va">pop.df</span><span class="op">$</span><span class="va">x</span><span class="op">[</span> <span class="va">pop.df</span><span class="op">$</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">]</span> , <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span> <span class="st">"SEX"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span> <span class="va">pop.df</span><span class="op">$</span><span class="va">SEX</span><span class="op">[</span> <span class="va">pop.df</span><span class="op">$</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">]</span> <span class="op">)</span> <span class="op">)</span> , FUN <span class="op">=</span> <span class="va">mean</span> <span class="op">)</span> <span class="op">)</span></span>
<span><span class="va">group.pshare</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/proportions.html" class="external-link">prop.table</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/by.html" class="external-link">by</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span> <span class="fl">1</span> , <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span> <span class="va">pop.df</span><span class="op">$</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">)</span> <span class="op">)</span> , <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span> <span class="st">"SEX"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span> <span class="va">pop.df</span><span class="op">$</span><span class="va">SEX</span><span class="op">[</span> <span class="va">pop.df</span><span class="op">$</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">]</span> <span class="op">)</span> <span class="op">)</span> , FUN <span class="op">=</span> <span class="va">sum</span> <span class="op">)</span> <span class="op">)</span> <span class="op">)</span> </span>
<span><span class="va">jdivb.pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span> <span class="va">group.pshare</span> <span class="op">*</span> <span class="op">(</span> <span class="va">group.mean</span> <span class="op">/</span> <span class="va">overall.mean</span> <span class="op">-</span> <span class="fl">1</span> <span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span> <span class="va">group.mean</span> <span class="op">/</span> <span class="va">overall.mean</span> <span class="op">)</span> <span class="op">)</span></span>
<span><span class="va">jdivw.pop</span> <span class="op">&lt;-</span> <span class="va">jdivt.pop</span> <span class="op">-</span> <span class="va">jdivb.pop</span></span>
<span><span class="op">(</span> <span class="va">theta.pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="va">jdivt.pop</span> , <span class="va">jdivw.pop</span> , <span class="va">jdivb.pop</span> <span class="op">)</span> <span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.433264877 0.428398928 0.004865949</span></span>
<span></span>
<span><span class="co"># estimate the expected value of the J-divergence decomposition estimator</span></span>
<span><span class="co"># using the average of the estimates</span></span>
<span><span class="op">(</span> <span class="va">theta.exp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span> <span class="va">estimate.list</span> , <span class="va">coef</span> <span class="op">)</span> <span class="op">)</span> <span class="op">)</span></span>
<span><span class="co">#&gt;       total      within     between </span></span>
<span><span class="co">#&gt; 0.432782322 0.427480257 0.005302065</span></span>
<span></span>
<span><span class="co"># estimate the percentage relative bias</span></span>
<span><span class="fl">100</span> <span class="op">*</span> <span class="op">(</span> <span class="va">theta.exp</span><span class="op">/</span><span class="va">theta.pop</span> <span class="op">-</span> <span class="fl">1</span> <span class="op">)</span></span>
<span><span class="co">#&gt;      total     within    between </span></span>
<span><span class="co">#&gt; -0.1113765 -0.2144430  8.9626164</span></span></code></pre></div>
<p>The estimated PRB for the total is the same as before, so we will
focus on the within and between components. While the within component
has a small relative bias (-0.21%), the between component PRB is
significant, amounting to 8.96%. We will discuss this further.</p>
<p>For the variance estimator, we do:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># estimate the variance of the J-divergence estimator</span></span>
<span><span class="co"># using the variance of the estimates</span></span>
<span><span class="op">(</span> <span class="va">vartheta.popest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span> <span class="va">estimate.list</span> , <span class="va">coef</span> <span class="op">)</span> <span class="op">)</span> <span class="op">)</span> <span class="op">)</span> <span class="op">)</span></span>
<span><span class="co">#&gt;        total       within      between </span></span>
<span><span class="co">#&gt; 5.434848e-04 5.391901e-04 8.750879e-06</span></span>
<span></span>
<span><span class="co"># estimate the expected value of the J-divergence index variance estimator</span></span>
<span><span class="co"># using the expected of the variance estimates</span></span>
<span><span class="op">(</span> <span class="va">vartheta.exp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span> <span class="va">estimate.list</span> , <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="co">#&gt;        total       within      between </span></span>
<span><span class="co">#&gt; 5.342947e-04 5.286750e-04 8.891772e-06</span></span>
<span></span>
<span><span class="co"># estimate the percentage relative bias of the variance estimator</span></span>
<span><span class="fl">100</span> <span class="op">*</span> <span class="op">(</span> <span class="va">vartheta.exp</span><span class="op">/</span><span class="va">vartheta.popest</span> <span class="op">-</span> <span class="fl">1</span> <span class="op">)</span></span>
<span><span class="co">#&gt;     total    within   between </span></span>
<span><span class="co">#&gt; -1.690964 -1.950177  1.610034</span></span></code></pre></div>
<p>The PRB of the variance estimators for both components are small:
-1.95% for the within component and 1.61% for the between component.</p>
<p>Now, how much should we care about the between component bias? Our
simulations show that the Squared Bias of this estimator accounts for
less than 2% of its Mean Squared Error:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">theta.bias2</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">theta.exp</span> <span class="op">-</span> <span class="va">theta.pop</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span></span>
<span><span class="va">theta.mse</span> <span class="op">&lt;-</span> <span class="va">theta.bias2</span> <span class="op">+</span> <span class="va">vartheta.popest</span></span>
<span><span class="fl">100</span> <span class="op">*</span> <span class="op">(</span> <span class="va">theta.bias2</span><span class="op">/</span><span class="va">theta.mse</span> <span class="op">)</span></span>
<span><span class="co">#&gt;      total     within    between </span></span>
<span><span class="co">#&gt; 0.04282728 0.15627854 2.12723212</span></span></code></pre></div>
<p>Next, we evaluate the Percentage Coverage Rate (PCR). In theory,
under repeated sampling, the estimated 95% CIs should cover the
population parameter 95% of the time. We can evaluate that using:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># estimate confidence intervals of the Zenga index</span></span>
<span><span class="co"># for each of the samples</span></span>
<span><span class="va">est.coverage</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span> <span class="va">estimate.list</span>, <span class="kw">function</span><span class="op">(</span> <span class="va">this.stat</span> <span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span> <span class="va">this.stat</span> <span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;=</span> <span class="va">theta.pop</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span> <span class="va">this.stat</span> <span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&gt;=</span> <span class="va">theta.pop</span>  <span class="op">)</span> <span class="op">)</span> </span>
<span></span>
<span><span class="co"># evaluate</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span> <span class="va">est.coverage</span> <span class="op">)</span></span>
<span><span class="co">#&gt;   total  within between </span></span>
<span><span class="co">#&gt;  0.9390  0.9376  0.9108</span></span></code></pre></div>
<p>Our coverages are not too far from the nominal coverage level of 95%,
however the bias in the between estimator can affect its coverage
rate.</p>
<p>For additional usage examples of <code>svyjdiv</code> or
<code>svyjdivdec</code>, type <code><a href="../reference/svyjdiv.html">?convey::svyjdiv</a></code> or
<code><a href="../reference/svyjdivdec.html">?convey::svyjdivdec</a></code> in the R console.</p>
</div>
<div class="section level2">
<h2 id="atkinson-index-svyatk">Atkinson index (svyatk)<a class="anchor" aria-label="anchor" href="#atkinson-index-svyatk"></a>
</h2>
<p>Although the original formula was proposed in <span class="citation">Atkinson (1970)</span>, the estimator used here comes
from <span class="citation">Biewen and Jenkins (2003)</span>:</p>
<p><span class="math display">\[
\widehat{A}_\epsilon =
\begin{cases}
1 - \widehat{U}_0^{ - \epsilon/(1 - \epsilon) } \widehat{U}_1^{ -1 }
\widehat{U}_{1 - \epsilon}^{ 1/(1 - \epsilon) } , &amp;\text{if }
\epsilon \in \mathbb{R}_+ \setminus\{ 1 \} \\
1 - \widehat{U}_0 \widehat{U}_0^{-1} exp( \widehat{T}_0
\widehat{U}_0^{-1} ), &amp;\text{if } \epsilon \rightarrow1
\end{cases}
\]</span></p>
<p>The <span class="math inline">\(\epsilon\)</span> is an inequality
aversion parameter: as it approaches infinity, more weight is given to
incomes in bottom of the distribution.</p>
<hr>
<p><strong>A replication example</strong></p>
<p>In July 2006, <span class="citation">Jenkins (2008)</span> presented
at the North American Stata Users’ Group Meetings on the stata Atkinson
Index command. The example below reproduces those statistics.</p>
<p>Load and prepare the same data set:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load the convey package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://guilhermejacob.github.io/context/" class="external-link">convey</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># load the survey library</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://r-survey.r-forge.r-project.org/survey/" class="external-link">survey</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># load the foreign library</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://svn.r-project.org/R-packages/trunk/foreign/" class="external-link">foreign</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create a temporary file on the local disk</span></span>
<span><span class="va">tf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># store the location of the presentation file</span></span>
<span><span class="va">presentation_zip</span> <span class="op">&lt;-</span> <span class="st">"http://repec.org/nasug2006/nasug2006_jenkins.zip"</span></span>
<span></span>
<span><span class="co"># download jenkins' presentation to the temporary file</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span> <span class="va">presentation_zip</span> , <span class="va">tf</span> , mode <span class="op">=</span> <span class="st">'wb'</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># unzip the contents of the archive</span></span>
<span><span class="va">presentation_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/unzip.html" class="external-link">unzip</a></span><span class="op">(</span> <span class="va">tf</span> , exdir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># load the institute for fiscal studies' 1981, 1985, and 1991 data.frame objects</span></span>
<span><span class="va">x81</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/foreign/man/read.dta.html" class="external-link">read.dta</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span> <span class="st">"ifs81"</span> , <span class="va">presentation_files</span> , value <span class="op">=</span> <span class="cn">TRUE</span> <span class="op">)</span> <span class="op">)</span></span>
<span><span class="va">x85</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/foreign/man/read.dta.html" class="external-link">read.dta</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span> <span class="st">"ifs85"</span> , <span class="va">presentation_files</span> , value <span class="op">=</span> <span class="cn">TRUE</span> <span class="op">)</span> <span class="op">)</span></span>
<span><span class="va">x91</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/foreign/man/read.dta.html" class="external-link">read.dta</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span> <span class="st">"ifs91"</span> , <span class="va">presentation_files</span> , value <span class="op">=</span> <span class="cn">TRUE</span> <span class="op">)</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># stack each of these three years of data into a single data.frame</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span> <span class="va">x81</span> , <span class="va">x85</span> , <span class="va">x91</span> <span class="op">)</span></span></code></pre></div>
<p>Replicate the author’s survey design statement from stata code..</p>
<pre><code>. * account for clustering within HHs 
. version 8: svyset [pweight = wgt], psu(hrn)
pweight is wgt
psu is hrn
construct an</code></pre>
<p>.. into R code:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># initiate a linearized survey design object</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/svydesign.html" class="external-link">svydesign</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">hrn</span> , data <span class="op">=</span> <span class="va">x</span> , weights <span class="op">=</span> <span class="op">~</span> <span class="va">wgt</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># immediately run the `convey_prep` function on the survey design</span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/convey_prep.html">convey_prep</a></span><span class="op">(</span> <span class="va">y</span> <span class="op">)</span></span></code></pre></div>
<p>Replicate the author’s subset statement and each of his svyatk
results with stata..</p>
<pre><code>. svyatk x if year == 1981
 
Warning: x has 20 values = 0. Not used in calculations

Complex survey estimates of Atkinson inequality indices
 
pweight: wgt                                   Number of obs    = 9752
Strata: &lt;one&gt;                                  Number of strata = 1
PSU: hrn                                       Number of PSUs   = 7459
                                               Population size  = 54766261
---------------------------------------------------------------------------
Index    |  Estimate   Std. Err.      z      P&gt;|z|     [95% Conf. Interval]
---------+-----------------------------------------------------------------
A(0.5)   |  .0543239   .00107583    50.49    0.000      .0522153   .0564324
A(1)     |  .1079964   .00245424    44.00    0.000      .1031862   .1128066
A(1.5)   |  .1701794   .0066943    25.42    0.000       .1570588      .1833
A(2)     |  .2755788   .02597608    10.61    0.000      .2246666    .326491
A(2.5)   |  .4992701   .06754311     7.39    0.000       .366888   .6316522
---------------------------------------------------------------------------</code></pre>
<p>..using R code:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">z81</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span> <span class="va">z</span> , <span class="va">year</span> <span class="op">==</span> <span class="fl">1981</span> <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/svyatk.html">svyatk</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">eybhc0</span> , <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span> <span class="va">z81</span> , <span class="va">eybhc0</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">)</span> , epsilon <span class="op">=</span> <span class="fl">0.5</span> <span class="op">)</span></span>
<span><span class="co">#&gt;        atkinson     SE</span></span>
<span><span class="co">#&gt; eybhc0 0.054324 0.0011</span></span>
<span><span class="fu"><a href="../reference/svyatk.html">svyatk</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">eybhc0</span> , <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span> <span class="va">z81</span> , <span class="va">eybhc0</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">)</span> <span class="op">)</span></span>
<span><span class="co">#&gt;        atkinson     SE</span></span>
<span><span class="co">#&gt; eybhc0    0.108 0.0025</span></span>
<span><span class="fu"><a href="../reference/svyatk.html">svyatk</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">eybhc0</span> , <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span> <span class="va">z81</span> , <span class="va">eybhc0</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">)</span> , epsilon <span class="op">=</span> <span class="fl">1.5</span> <span class="op">)</span></span>
<span><span class="co">#&gt;        atkinson     SE</span></span>
<span><span class="co">#&gt; eybhc0  0.17018 0.0067</span></span>
<span><span class="fu"><a href="../reference/svyatk.html">svyatk</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">eybhc0</span> , <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span> <span class="va">z81</span> , <span class="va">eybhc0</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">)</span> , epsilon <span class="op">=</span> <span class="fl">2</span> <span class="op">)</span></span>
<span><span class="co">#&gt;        atkinson    SE</span></span>
<span><span class="co">#&gt; eybhc0  0.27558 0.026</span></span>
<span><span class="fu"><a href="../reference/svyatk.html">svyatk</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">eybhc0</span> , <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span> <span class="va">z81</span> , <span class="va">eybhc0</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">)</span> , epsilon <span class="op">=</span> <span class="fl">2.5</span> <span class="op">)</span></span>
<span><span class="co">#&gt;        atkinson     SE</span></span>
<span><span class="co">#&gt; eybhc0  0.49927 0.0675</span></span></code></pre></div>
<p>Confirm this replication applies for subsetted objects as well,
comparing stata code..</p>
<pre><code>. svyatk x if year == 1981 &amp; x &gt;= 1

Complex survey estimates of Atkinson inequality indices
 
pweight: wgt                                   Number of obs    = 9748
Strata: &lt;one&gt;                                  Number of strata = 1
PSU: hrn                                       Number of PSUs   = 7457
                                               Population size  = 54744234
---------------------------------------------------------------------------
Index    |  Estimate   Std. Err.      z      P&gt;|z|     [95% Conf. Interval]
---------+-----------------------------------------------------------------
A(0.5)   |  .0540059   .00105011    51.43    0.000      .0519477   .0560641
A(1)     |  .1066082   .00223318    47.74    0.000      .1022313   .1109852
A(1.5)   |  .1638299   .00483069    33.91    0.000       .154362   .1732979
A(2)     |  .2443206   .01425258    17.14    0.000      .2163861   .2722552
A(2.5)   |   .394787   .04155221     9.50    0.000      .3133461   .4762278
---------------------------------------------------------------------------</code></pre>
<p>..to R code:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">z81_two</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span> <span class="va">z</span> , <span class="va">year</span> <span class="op">==</span> <span class="fl">1981</span> <span class="op">&amp;</span> <span class="va">eybhc0</span> <span class="op">&gt;</span> <span class="fl">1</span> <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/svyatk.html">svyatk</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">eybhc0</span> , <span class="va">z81_two</span> , epsilon <span class="op">=</span> <span class="fl">0.5</span> <span class="op">)</span></span>
<span><span class="co">#&gt;        atkinson     SE</span></span>
<span><span class="co">#&gt; eybhc0 0.054006 0.0011</span></span>
<span><span class="fu"><a href="../reference/svyatk.html">svyatk</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">eybhc0</span> , <span class="va">z81_two</span> <span class="op">)</span></span>
<span><span class="co">#&gt;        atkinson     SE</span></span>
<span><span class="co">#&gt; eybhc0  0.10661 0.0022</span></span>
<span><span class="fu"><a href="../reference/svyatk.html">svyatk</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">eybhc0</span> , <span class="va">z81_two</span> , epsilon <span class="op">=</span> <span class="fl">1.5</span> <span class="op">)</span></span>
<span><span class="co">#&gt;        atkinson     SE</span></span>
<span><span class="co">#&gt; eybhc0  0.16383 0.0048</span></span>
<span><span class="fu"><a href="../reference/svyatk.html">svyatk</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">eybhc0</span> , <span class="va">z81_two</span> , epsilon <span class="op">=</span> <span class="fl">2</span> <span class="op">)</span></span>
<span><span class="co">#&gt;        atkinson     SE</span></span>
<span><span class="co">#&gt; eybhc0  0.24432 0.0143</span></span>
<span><span class="fu"><a href="../reference/svyatk.html">svyatk</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">eybhc0</span> , <span class="va">z81_two</span> , epsilon <span class="op">=</span> <span class="fl">2.5</span> <span class="op">)</span></span>
<span><span class="co">#&gt;        atkinson     SE</span></span>
<span><span class="co">#&gt; eybhc0  0.39479 0.0416</span></span></code></pre></div>
<p>For additional usage examples of <code>svyatk</code>, type
<code><a href="../reference/svyatk.html">?convey::svyatk</a></code> in the R console.</p>
</div>
<div class="section level2">
<h2 id="which-inequality-measure-should-be-used">Which inequality measure should be used?<a class="anchor" aria-label="anchor" href="#which-inequality-measure-should-be-used"></a>
</h2>
<p>The variety of inequality measures begs a question: which inequality
measure shuold be used? In fact, this is a very important question.
However, the nature of it is not statistical or mathematical, but
ethical. This section aims to clarify and, while not proposing a
“perfect measure”, to provide the reader with an initial guidance about
which measure to use.</p>
<p>The most general way to analyze if one distribution is more equally
distributed than another is by the Lorenz curve. When <span class="math inline">\(L_A(p) \geqslant L_B(p), \forall p \in
[0,1]\)</span>, it is said that <span class="math inline">\(A\)</span>
is more equally distributed than <span class="math inline">\(B\)</span>.
Technically, we say that <span class="math inline">\(A\)</span>
<em>(Lorenz )dominates</em> <span class="math inline">\(B\)</span><a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a>. In this
case, all inequality measures that satisfy basic properties<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a> will agree
that <span class="math inline">\(A\)</span> is more equally distributed
than <span class="math inline">\(B\)</span>.</p>
<p>When this dominance fails, i.e., when Lorenz curves do cross, Lorenz
ordering is impossible. Then, under such circumstances, the choice of
which inequality measure to use becomes relevant.</p>
<p>Each inequality measure is a result of a subjective understanding of
what is a fair distribution. As <span class="citation">Dalton (1920,
348)</span> puts it, “[…] the economist is primarily interested, not in
the distribution of income as such, but in the effects of the
distribution of income upon the distribution and total amount of
economic welfare, which may be derived from income.” The importance of
how economic welfare is defined is once again expressed by <span class="citation">Atkinson (1970)</span>, where an inequality measure is
direclty derived from a class of welfare functions. Even when a welfare
function is not explicit, such as in the Gini index, we must agree that
an implicit, subjective judgement of the impact of inequality on social
welfare is assumed.</p>
<p>The idea of what is a fair distribution is a matter of Ethics, a
discipline within the realm of Philosophy. Yet, as <span class="citation">Fleurbaey (1996, Ch.1)</span> proposes, the analyst
should match socially supported moral values and theories of justice to
the set of technical tools for policy evaluation.</p>
<p>Although this can be a useful principle, a more objective answer is
needed. By knowing the nature and properties of inequality measures, the
analyst can further reduce the set of applicable inequality measures.
For instance, choosing from the properties listed in <span class="citation">Frank Alan Cowell (2011, 74)</span>, if we require
group-decomposability, scale invariance, population invariance, and that
the estimate in <span class="math inline">\([0,1]\)</span>, we must
resort to the Atkinson index.</p>
<p>Even though the discussion can go deep in technical and philosophical
aspects, this choice also depends on the public. For example, it would
not be surprising if a public official doesn’t know the Atkinson index;
however, he might know the Gini index. The same goes for publications:
journalists have been introduced to the Gini index and can find it
easier to compare and, therefore, write about it. Also, we must admit
that the Gini index is much more straightforward than any other
measure.</p>
<p>In the end, the choice is mostly subjective and there is no consensus
of which is the “greatest inequality measure”. We must remember that
this choice is only problematic if Lorenz curves cross and, in that
case, it is not difficult to justify the use of this or that inequality
measure.</p>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-atkinson1970" class="csl-entry">
Atkinson, Anthony B. 1970. <span>“On the Measurement of
Inequality.”</span> <em>Journal of Economic Theory</em> 2 (3): 244–63.
<a href="https://ideas.repec.org/a/eee/jetheo/v2y1970i3p244-263.html" class="external-link">https://ideas.repec.org/a/eee/jetheo/v2y1970i3p244-263.html</a>.
</div>
<div id="ref-barabesi2016" class="csl-entry">
Barabesi, Lucio, Giancarlo Diana, and Pier Francesco Perri. 2016.
<span>“Linearization of Inequality Indices in the Design-Based
Framework.”</span> <em>Statistics</em> 50 (5): 1161–72. <a href="https://doi.org/10.1080/02331888.2015.1135924" class="external-link">https://doi.org/10.1080/02331888.2015.1135924</a>.
</div>
<div id="ref-biewen2003" class="csl-entry">
Biewen, Martin, and Stephen Jenkins. 2003. <span>“Estimation of
Generalized Entropy and Atkinson Inequality Indices from Complex Survey
Data.”</span> Discussion Papers of DIW Berlin 345. DIW Berlin, German
Institute for Economic Research. <a href="http://EconPapers.repec.org/RePEc:diw:diwwpp:dp345" class="external-link">http://EconPapers.repec.org/RePEc:diw:diwwpp:dp345</a>.
</div>
<div id="ref-vardpoor" class="csl-entry">
Breidaks, Juris, Martins Liberts, and Santa Ivanova. 2016.
<span>“Vardpoor: Estimation of Indicators on Social Exclusion and
Poverty and Its Linearization, Variance Estimation.”</span> Riga,
Latvia: CSB.
</div>
<div id="ref-cobham2015" class="csl-entry">
Cobham, Alex, Luke Schlogl, and Andy Sumner. 2015. <span>“<span class="nocase">Inequality and the Tails: The Palma Proposition and Ratio
Revisited</span>.”</span> Working Papers 143. United Nations, Department
of Economics; Social Affairs. <a href="http://www.un.org/esa/desa/papers/2015/wp143_2015.pdf" class="external-link">http://www.un.org/esa/desa/papers/2015/wp143_2015.pdf</a>.
</div>
<div id="ref-cowell2009" class="csl-entry">
Cowell, Frank A., Emmanuel Flachaire, and Sanghamitra Bandyopadhyay.
2009. <span>“Goodness-of-Fit: An Economic Approach.”</span> Economics
Series Working Papers 444. University of Oxford, Department of
Economics. <a href="https://ideas.repec.org/p/oxf/wpaper/444.html" class="external-link">https://ideas.repec.org/p/oxf/wpaper/444.html</a>.
</div>
<div id="ref-cowell2011" class="csl-entry">
Cowell, Frank Alan. 2011. <em>Measuring Inequality</em>. 3rd ed. London
School of Economics Perspectives in Economic Analysis. New York: Oxford
University Press.
</div>
<div id="ref-dalton1920" class="csl-entry">
Dalton, Hugh. 1920. <span>“The Measurement of the Inequality of
Incomes.”</span> <em>The Economic Journal</em> 30 (September). <a href="https://doi.org/10.2307/2223525" class="external-link">https://doi.org/10.2307/2223525</a>.
</div>
<div id="ref-demnati2004" class="csl-entry">
Demnati, A., and J. N. K. Rao. 2004. <span>“<span class="nocase">Linearization Variance Estimators for Survey
Data</span>.”</span> <em>Survey Methodology</em> 30 (1): 17–26. <a href="https://www150.statcan.gc.ca/n1/en/pub/12-001-x/2004001/article/6991-eng.pdf" class="external-link">https://www150.statcan.gc.ca/n1/en/pub/12-001-x/2004001/article/6991-eng.pdf</a>.
</div>
<div id="ref-deville1999" class="csl-entry">
Deville, Jean-Claude. 1999. <span>“Variance Estimation for Complex
Statistics and Estimators: Linearization and Residual
Techniques.”</span> <em>Survey Methodology</em> 25 (2): 193–203. <a href="http://www.statcan.gc.ca/pub/12-001-x/1999002/article/4882-eng.pdf" class="external-link">http://www.statcan.gc.ca/pub/12-001-x/1999002/article/4882-eng.pdf</a>.
</div>
<div id="ref-fleur1996" class="csl-entry">
Fleurbaey, Marc. 1996. <em>Théories Économiques de La Justice</em>.
Économie Et Statistiques Avancées. Paris: Economica.
</div>
<div id="ref-hardy1934" class="csl-entry">
Hardy, G. H., J. E. Littlewood, and G. Pólya. 1934.
<em>Inequalities</em>. 2nd ed. Cambridge University Press.
</div>
<div id="ref-jann2016" class="csl-entry">
Jann, Ben. 2016. <span>“<span class="nocase">Estimating Lorenz and
concentration curves in Stata</span>.”</span> University of Bern Social
Sciences Working Papers 15. University of Bern, Department of Social
Sciences. <a href="https://ideas.repec.org/p/bss/wpaper/15.html" class="external-link">https://ideas.repec.org/p/bss/wpaper/15.html</a>.
</div>
<div id="ref-jenkins2006" class="csl-entry">
Jenkins, Stephen. 2008. <span>“Estimation and Interpretation of Measures
of Inequality, Poverty, and Social Welfare Using Stata.”</span> North
American Stata Users' Group Meetings 2006. Stata Users Group. <a href="http://EconPapers.repec.org/RePEc:boc:asug06:16" class="external-link">http://EconPapers.repec.org/RePEc:boc:asug06:16</a>.
</div>
<div id="ref-kovacevic1997" class="csl-entry">
Kovacevic, Milorad, and David Binder. 1997. <span>“Variance Estimation
for Measures of Income Inequality and Polarization - the Estimating
Equations Approach.”</span> <em>Journal of Official Statistics</em> 13
(1): 41–58. <a href="http://www.jos.nu/Articles/abstract.asp?article=13141" class="external-link">http://www.jos.nu/Articles/abstract.asp?article=13141</a>.
</div>
<div id="ref-kramer1998" class="csl-entry">
Krämer, Walter. 1998. <span>“Measurement of Inequality.”</span> In
<em>Handbook of Applied Economic Statistics</em>, edited by Amman Ullah
and David E. A. Giles, 1st ed., 39–62. Statistics: A Series of Textbooks
and Monographs 155. New York: Marcel Dekker.
</div>
<div id="ref-langel2011" class="csl-entry">
Langel, Matti, and Yves Tillé. 2012. <span>“Inference by Linearization
for Zenga’s New Inequality Index: A Comparison with the Gini
Index.”</span> <em>Metrika</em> 75 (8): 1093–1110. <a href="https://doi.org/10.1007/s00184-011-0369-1" class="external-link">https://doi.org/10.1007/s00184-011-0369-1</a>.
</div>
<div id="ref-lerman1989" class="csl-entry">
Lerman, Robert, and Shlomo Yitzhaki. 1989. <span>“Improving the Accuracy
of Estimates of Gini Coefficients.”</span> <em>Journal of
Econometrics</em> 42 (1): 43–47. <a href="http://EconPapers.repec.org/RePEc:eee:econom:v:42:y:1989:i:1:p:43-47" class="external-link">http://EconPapers.repec.org/RePEc:eee:econom:v:42:y:1989:i:1:p:43-47</a>.
</div>
<div id="ref-olkin2011" class="csl-entry">
Marshall, Albert W., Ingram Olkin, and Barry C. Arnold. 2011.
<em>Inequalities: Theory of Majorization and Its Applications</em>. 2nd
ed. Springer Series in Statistics. Springer.
</div>
<div id="ref-mosler1994" class="csl-entry">
Mosler, Karl. 1994. <span>“Majorization in Economic Disparity
Measures.”</span> <em>Linear Algebra and Its Applications</em> 199:
91–114. https://doi.org/<a href="https://doi.org/10.1016/0024-3795(94)90343-3" class="external-link">https://doi.org/10.1016/0024-3795(94)90343-3</a>.
</div>
<div id="ref-osier2009" class="csl-entry">
Osier, Guillaume. 2009. <span>“Variance Estimation for Complex
Indicators of Poverty and Inequality.”</span> <em>Journal of the
European Survey Research Association</em> 3 (3): 167–95. <a href="http://ojs.ub.uni-konstanz.de/srm/article/view/369" class="external-link">http://ojs.ub.uni-konstanz.de/srm/article/view/369</a>.
</div>
<div id="ref-rohde2016" class="csl-entry">
Rohde, Nicholas. 2016. <span>“J-Divergence Measurements of Economic
Inequality.”</span> <em>Journal of the Royal Statistical Society: Series
A (Statistics in Society)</em> 179 (3): 847–70. <a href="https://doi.org/10.1111/rssa.12153" class="external-link">https://doi.org/10.1111/rssa.12153</a>.
</div>
<div id="ref-shannon1948" class="csl-entry">
Shannon, Claude E. 1948. <span>“A Mathematical Theory of
Communication.”</span> <em>Bell System Technical Journal</em> 27 (3):
379–423. <a href="https://doi.org/10.1002/j.1538-7305.1948.tb01338.x" class="external-link">https://doi.org/10.1002/j.1538-7305.1948.tb01338.x</a>.
</div>
<div id="ref-zenga2007" class="csl-entry">
Zenga, Michele. 2007. <span>“Inequality Curve and Inequality Index Based
on the Ratios Between Lower and Upper Arithmetic Means.”</span>
<em>Statistica e Applicazioni</em> 1 (4): 3–27.
</div>
</div>
</div>
<div class="footnotes footnotes-end-of-document">
<hr>
<ol>
<li id="fn1"><p>but not Conditional Poisson Sampling.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>Also known as Theil-T index.<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p><span class="citation">Krämer (1998)</span> and <span class="citation">Mosler (1994)</span> provide helpful insights to how
majorization, Lorenz dominance, and inequality measurement are
connected. On the topic of majorization, <span class="citation">Hardy,
Littlewood, and Pólya (1934)</span> is still the main reference, while
<span class="citation">Marshall, Olkin, and Arnold (2011)</span> provide
a more modern approach.<a href="#fnref3" class="footnote-back">↩︎</a></p></li>
<li id="fn4"><p>Namely, Schur-convexity, population invariance, and
scale invariance.<a href="#fnref4" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Djalma Pessoa, Anthony Damico, Guilherme Jacob.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
