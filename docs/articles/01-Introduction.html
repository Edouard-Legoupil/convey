<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>01- Poverty and Inequality with Complex Survey Data • convey</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="01- Poverty and Inequality with Complex Survey Data">
<meta property="og:description" content="convey">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">convey</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/01-Introduction.html">01- Poverty and Inequality with Complex Survey Data</a>
    </li>
    <li>
      <a href="../articles/02-poverty.html">Poverty Indices</a>
    </li>
    <li>
      <a href="../articles/03-inequality.html">Inequality Measurement </a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ajdamico/convey/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>01- Poverty and Inequality with Complex Survey
Data</h1>
                        <h4 data-toc-skip class="author">Guilherme
Jacob, Anthony Damico, and Djalma Pessoa</h4>
            
            <h4 data-toc-skip class="date">2022-09-06</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ajdamico/convey/blob/HEAD/vignettes/01-Introduction.Rmd" class="external-link"><code>vignettes/01-Introduction.Rmd</code></a></small>
      <div class="hidden name"><code>01-Introduction.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="survey">Complex surveys and statistical inference<a class="anchor" aria-label="anchor" href="#survey"></a>
</h2>
<p>In this book, we demonstrate how to measure poverty and income
concentration in a population based on microdata collected from a
complex survey sample. Most surveys administered by government agencies
or larger research organizations utilize a sampling design that violates
the assumption of simple random sampling (SRS), including:</p>
<ol style="list-style-type: decimal">
<li>Different units selection probabilities;</li>
<li>Clustering of units;</li>
<li>Stratification of clusters;</li>
<li>Reweighting to compensate for missing values and other
adjustments.</li>
</ol>
<p>Therefore, basic unweighted R commands such as <code><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean()</a></code> or
<code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm()</a></code> will not properly account for the weighting nor the
measures of uncertainty (such as the confidence intervals) present in
the dataset. For some examples of publicly-available complex survey data
sets, see <a href="">http://asdfree.com</a>.</p>
<p>Unlike other software, the R <code>convey</code> package does not
require that the user specify these parameters throughout the analysis.
So long as the <a href="http://r-survey.r-forge.r-project.org/survey/html/svydesign.html" class="external-link">svydesign
object</a> or <a href="http://r-survey.r-forge.r-project.org/survey/html/svrepdesign.html" class="external-link">svrepdesign
object</a> has been constructed properly at the outset of the analysis,
the <code>convey</code> package will incorporate the survey design
automatically and produce statistics and variances that take the complex
sample into account.</p>
</div>
<div class="section level2">
<h2 id="usage-examples">Usage Examples<a class="anchor" aria-label="anchor" href="#usage-examples"></a>
</h2>
<p>In the following example, we’ve loaded the data set
<code>eusilc</code> from the R library <a href="https://CRAN.R-project.org/package=laeken" class="external-link">laeken</a> <span class="citation">(Alfons and Templ 2013)</span>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">laeken</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">eusilc</span><span class="op">)</span></span></code></pre></div>
<p>Next, we create an object of class <code>survey.design</code> using
the function <code>svydesign</code> of the library survey:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://r-survey.r-forge.r-project.org/survey/" class="external-link">survey</a></span><span class="op">)</span></span>
<span><span class="va">des_eusilc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/svydesign.html" class="external-link">svydesign</a></span><span class="op">(</span>ids <span class="op">=</span> <span class="op">~</span><span class="va">rb030</span>, strata <span class="op">=</span><span class="op">~</span><span class="va">db040</span>,  weights <span class="op">=</span> <span class="op">~</span><span class="va">rb050</span>, data <span class="op">=</span> <span class="va">eusilc</span><span class="op">)</span></span></code></pre></div>
<p>Right after the creation of the design object
<code>des_eusilc</code>, we should use the function
<code>convey_prep</code> that adds an attribute to the survey design
which saves information on the design object based upon the whole
sample, needed to work with subset designs.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://guilhermejacob.github.io/context/" class="external-link">convey</a></span><span class="op">)</span></span>
<span><span class="va">des_eusilc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/convey_prep.html">convey_prep</a></span><span class="op">(</span> <span class="va">des_eusilc</span> <span class="op">)</span></span></code></pre></div>
<p>To estimate the at-risk-of-poverty rate, we use the function
<code>svyarpt</code>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">svyarpr</span>(<span class="sc">~</span>eqIncome, <span class="at">design=</span>des_eusilc)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>            arpr     SE</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>eqIncome <span class="fl">0.14444</span> <span class="fl">0.0028</span></span></code></pre></div>
<p>To estimate the at-risk-of-poverty rate across domains defined by the
variable <code>db040</code> we use:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">svyby</span>(<span class="sc">~</span>eqIncome, <span class="at">by =</span> <span class="sc">~</span>db040, <span class="at">design =</span> des_eusilc, <span class="at">FUN =</span> svyarpr, <span class="at">deff =</span> <span class="cn">FALSE</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>                      db040  eqIncome          se</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>Burgenland       Burgenland <span class="fl">0.1953984</span> <span class="fl">0.017202852</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>Carinthia         Carinthia <span class="fl">0.1308627</span> <span class="fl">0.010606502</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>Lower Austria Lower Austria <span class="fl">0.1384362</span> <span class="fl">0.006513217</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>Salzburg           Salzburg <span class="fl">0.1378734</span> <span class="fl">0.011581408</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>Styria               Styria <span class="fl">0.1437464</span> <span class="fl">0.007453192</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>Tyrol                 Tyrol <span class="fl">0.1530819</span> <span class="fl">0.009884094</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>Upper Austria Upper Austria <span class="fl">0.1088977</span> <span class="fl">0.005933094</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>Vienna               Vienna <span class="fl">0.1723468</span> <span class="fl">0.007684540</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>Vorarlberg       Vorarlberg <span class="fl">0.1653731</span> <span class="fl">0.013756389</span></span></code></pre></div>
<p>Using the same data set, we estimate the quintile share ratio:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># for the whole population</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">svyqsr</span>(<span class="sc">~</span>eqIncome, <span class="at">design=</span>des_eusilc, <span class="at">alpha1=</span> .<span class="dv">20</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>          qsr     SE</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>eqIncome <span class="fl">3.97</span> <span class="fl">0.0426</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># for domains</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="fu">svyby</span>(<span class="sc">~</span>eqIncome, <span class="at">by =</span> <span class="sc">~</span>db040, <span class="at">design =</span> des_eusilc,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">FUN =</span> svyqsr, <span class="at">alpha1=</span> .<span class="dv">20</span>, <span class="at">deff =</span> <span class="cn">FALSE</span>)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>                      db040 eqIncome         se</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>Burgenland       Burgenland <span class="fl">5.008486</span> <span class="fl">0.32755685</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>Carinthia         Carinthia <span class="fl">3.562404</span> <span class="fl">0.10909726</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>Lower Austria Lower Austria <span class="fl">3.824539</span> <span class="fl">0.08783599</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>Salzburg           Salzburg <span class="fl">3.768393</span> <span class="fl">0.17015086</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>Styria               Styria <span class="fl">3.464305</span> <span class="fl">0.09364800</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>Tyrol                 Tyrol <span class="fl">3.586046</span> <span class="fl">0.13629739</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>Upper Austria Upper Austria <span class="fl">3.668289</span> <span class="fl">0.09310624</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>Vienna               Vienna <span class="fl">4.654743</span> <span class="fl">0.13135731</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>Vorarlberg       Vorarlberg <span class="fl">4.366511</span> <span class="fl">0.20532075</span></span></code></pre></div>
<p>These functions can be used as S3 methods for the classes
<code>survey.design</code> and <code>svyrep.design</code>.</p>
<p>Let’s create a design object of class <code>svyrep.design</code> and
run the function <code>convey_prep</code> on it:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">des_eusilc_rep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/as.svrepdesign.html" class="external-link">as.svrepdesign</a></span><span class="op">(</span><span class="va">des_eusilc</span>, type <span class="op">=</span> <span class="st">"bootstrap"</span><span class="op">)</span></span>
<span><span class="va">des_eusilc_rep</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/convey_prep.html">convey_prep</a></span><span class="op">(</span><span class="va">des_eusilc_rep</span><span class="op">)</span> </span></code></pre></div>
<p>and then use the function <code>svyarpr</code>:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">svyarpr</span>(<span class="sc">~</span>eqIncome, <span class="at">design=</span>des_eusilc_rep)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>            arpr     SE</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>eqIncome <span class="fl">0.14444</span> <span class="fl">0.0025</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">svyby</span>(<span class="sc">~</span>eqIncome, <span class="at">by =</span> <span class="sc">~</span>db040, <span class="at">design =</span> des_eusilc_rep, <span class="at">FUN =</span> svyarpr, <span class="at">deff =</span> <span class="cn">FALSE</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>                      db040  eqIncome se.eqIncome</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>Burgenland       Burgenland <span class="fl">0.1953984</span> <span class="fl">0.016713791</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>Carinthia         Carinthia <span class="fl">0.1308627</span> <span class="fl">0.012061625</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>Lower Austria Lower Austria <span class="fl">0.1384362</span> <span class="fl">0.007294696</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>Salzburg           Salzburg <span class="fl">0.1378734</span> <span class="fl">0.010050357</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>Styria               Styria <span class="fl">0.1437464</span> <span class="fl">0.008558783</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>Tyrol                 Tyrol <span class="fl">0.1530819</span> <span class="fl">0.010328225</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>Upper Austria Upper Austria <span class="fl">0.1088977</span> <span class="fl">0.006212301</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>Vienna               Vienna <span class="fl">0.1723468</span> <span class="fl">0.007259732</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>Vorarlberg       Vorarlberg <span class="fl">0.1653731</span> <span class="fl">0.012792618</span></span></code></pre></div>
<p>The functions of the library convey are called in a similar way to
the functions in library survey.</p>
<p>It is also possible to deal with missing values by using the argument
<code>na.rm</code>.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># survey.design using a variable with missings</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">svygini</span>( <span class="sc">~</span> py010n , <span class="at">design =</span> des_eusilc )</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>       gini SE</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>py010n   <span class="cn">NA</span> <span class="cn">NA</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">svygini</span>( <span class="sc">~</span> py010n , <span class="at">design =</span> des_eusilc , <span class="at">na.rm =</span> <span class="cn">TRUE</span> )</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>          gini     SE</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>py010n <span class="fl">0.64606</span> <span class="fl">0.0036</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co"># svyrep.design using a variable with missings</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="fu">svygini</span>( <span class="sc">~</span> py010n , <span class="at">design =</span> des_eusilc_rep )</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>       gini SE</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>py010n   <span class="cn">NA</span> <span class="cn">NA</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="fu">svygini</span>( <span class="sc">~</span> py010n , <span class="at">design =</span> des_eusilc_rep , <span class="at">na.rm =</span> <span class="cn">TRUE</span> )</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>          gini     SE</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>py010n <span class="fl">0.64606</span> <span class="fl">0.0043</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="underlying-calculations">Underlying Calculations<a class="anchor" aria-label="anchor" href="#underlying-calculations"></a>
</h2>
<p>In what follows, we often use the linearization method as a tool to
produce an approximation for the variance of an estimator. From the
linearized variable <span class="math inline">\(z\)</span> of an
estimator <span class="math inline">\(T\)</span>, we get from the
expression @ref(eq:var) an estimate of the variance of <span class="math inline">\(T\)</span></p>
<p>If <span class="math inline">\(T\)</span> can be expressed as a
function of the population totals <span class="math inline">\(T = g(Y_1,
Y_2, \ldots, Y_n)\)</span>, and if <span class="math inline">\(g\)</span> is linear, the estimation of the
variance of <span class="math inline">\(T = g(Y_1, Y_2, \ldots,
Y_n)\)</span> is straightforward. If <span class="math inline">\(g\)</span> is not linear but is a ‘smooth’
function, then it is possible to approximate the variance of <span class="math inline">\(g(Y_1, Y_2, \ldots, Y_n)\)</span> by the variance
of its first order Taylor expansion. For example, we can use Taylor
expansion to linearize the ratio of two totals. However, there are
situations where Taylor linearization cannot be immediately possible,
either because <span class="math inline">\(T\)</span> cannot be
expressed as functions of the population totals, or because <span class="math inline">\(g\)</span> is not a <code>smooth</code> function.
An example is the case where <span class="math inline">\(T\)</span> is a
quantile.</p>
<p>In these cases, it might work an alternative form of linearization of
<span class="math inline">\(T\)</span>, by
<code>Influence Function</code>, as defined in @ref(eq:lin), proposed in
<span class="citation">Deville (1999)</span>. Also, it coud be used
replication methods such as <code>bootstrap</code> and
<code>jackknife</code>.</p>
<p>In the <code>convey</code> library, there are some basic functions
that produce the linearized variables needed to measure income
concentration and poverty. For example, looking at the income variable
in some complex survey dataset, the <code>quantile</code> of that income
variable can be linearized by the function
<code><a href="../reference/svyiqalpha.html">convey::svyiqalpha</a></code> and the sum total below any quantile of
the variable is linearized by the function
<code><a href="../reference/svyisq.html">convey::svyisq</a></code>.</p>
<p>From the linearized variables of these basic estimates, it is
possible by using rules of composition, valid for influence functions,
to derive the influence function of more complex estimates. By
definition the influence function is a Gateaux derivative and the rules
rules of composition valid for Gateaux derivatives also hold for
Influence Functions.</p>
<p>The following property of Gateaux derivatives was often used in the
library convey. Let <span class="math inline">\(g\)</span> be a
differentiable function of <span class="math inline">\(m\)</span>
variables. Suppose we want to compute the influence function of the
estimator <span class="math inline">\(g(T_1, T_2,\ldots, T_m)\)</span>,
knowing the Influence function of the estimators <span class="math inline">\(T_i, i=1,\ldots, m\)</span>. Then the following
holds:</p>
<p><span class="math display">\[
I(g(T_1, T_2,\ldots, T_m)) = \sum_{i=1}^m \frac{\partial g}{\partial
T_i}I(T_i)
\]</span></p>
<p>In the library convey this rule is implemented by the function
<code>contrastinf</code> which uses the R function <code>deriv</code> to
compute the formal partial derivatives <span class="math inline">\(\frac{\partial g}{\partial T_i}\)</span>.</p>
<p>For example, suppose we want to linearize the
<code>Relative median poverty gap</code>(rmpg), defined as the
difference between the at-risk-of-poverty threshold (<code>arpt</code>)
and the median of incomes less than the <code>arpt</code> relative to
the <code>arprt</code>:</p>
<p><span class="math display">\[
rmpg= \frac{arpt-medpoor} {arpt}
\]</span></p>
<p>where <code>medpoor</code> is the median of incomes less than
<code>arpt</code>.</p>
<p>Suppose we know how to linearize <code>arpt</code> and
<code>medpoor</code>, then by applying the function
<code>contrastinf</code> with <span class="math display">\[
g(T_1,T_2)= \frac{(T_1 - T_2)}{T_1}
\]</span> we linearize the <code>rmpg</code>.</p>
</div>
<div class="section level2">
<h2 id="the-variance-estimator">The Variance Estimator<a class="anchor" aria-label="anchor" href="#the-variance-estimator"></a>
</h2>
<p>Using the notation in <span class="citation">Osier (2009)</span>, the
variance of the estimator <span class="math inline">\(T(\hat{M})\)</span> can approximated by:</p>
<p><span class="math display">\[\begin{equation}
Var\left[T(\hat{M})\right]\cong var\left[\sum_s w_i z_i\right]
(\#eq:var)
\end{equation}\]</span></p>
<p>The <code>linearized</code> variable <span class="math inline">\(z\)</span> is given by the derivative of the
functional:</p>
<p><span class="math display">\[\begin{equation}
z_k=lim_{t\rightarrow0}\frac{T(M+t\delta_k)-T(M)}{t}=IT_k(M)
(\#eq:lin)
\end{equation}\]</span></p>
<p>where, <span class="math inline">\(\delta_k\)</span> is the Dirac
measure in <span class="math inline">\(k\)</span>: <span class="math inline">\(\delta_k(i)=1\)</span> if and only if <span class="math inline">\(i=k\)</span>.</p>
<p>This <strong>derivative</strong> is called <strong>Influence
Function</strong> and was introduced in the area of <strong>Robust
Statistics</strong>.</p>
</div>
<div class="section level2">
<h2 id="influence-functions">Influence Functions<a class="anchor" aria-label="anchor" href="#influence-functions"></a>
</h2>
<p>Some measures of poverty and income concentration are defined by
non-differentiable functions so that it is not possible to use Taylor
linearization to estimate their variances. An alternative is to use
<strong>Influence functions</strong> as described in <span class="citation">Deville (1999)</span> and <span class="citation">Osier
(2009)</span>. The convey library implements this methodology to work
with <code>survey.design</code> objects and also with
<code>svyrep.design</code> objects.</p>
<p>Some examples of these measures are:</p>
<ul>
<li><p>At-risk-of-poverty threshold: <span class="math inline">\(arpt=.60q_{.50}\)</span> where <span class="math inline">\(q_{.50}\)</span> is the income median;</p></li>
<li><p>At-risk-of-poverty rate <span class="math inline">\(arpr=\frac{\sum_U 1(y_i \leq
arpt)}{N}.100\)</span></p></li>
<li><p>Quintile share ratio</p></li>
</ul>
<p><span class="math inline">\(qsr=\frac{\sum_U
1(y_i&gt;q_{.80})}{\sum_U 1(y_i\leq q_{.20})}\)</span></p>
<ul>
<li>Gini coefficient <span class="math inline">\(1+G=\frac{2\sum_U
(r_i-1)y_i}{N\sum_Uy_i}\)</span> where <span class="math inline">\(r_i\)</span> is the rank of <span class="math inline">\(y_i\)</span>.</li>
</ul>
<p>Note that it is not possible to use Taylor linearization for these
measures because they depend on quantiles and the Gini is defined as a
function of ranks. This could be done using the approach proposed by
Deville (1999) based upon influence functions.</p>
<p>Let <span class="math inline">\(U\)</span> be a population of size
<span class="math inline">\(N\)</span> and <span class="math inline">\(M\)</span> be a measure that allocates mass one to
the set composed by one unit, that is <span class="math inline">\(M(i)=M_i= 1\)</span> if <span class="math inline">\(i\in U\)</span> and <span class="math inline">\(M(i)=0\)</span> if <span class="math inline">\(i\notin U\)</span></p>
<p>Now, a population parameter <span class="math inline">\(\theta\)</span> can be expressed as a functional
of <span class="math inline">\(M\)</span> <span class="math inline">\(\theta=T(M)\)</span></p>
<p>Examples of such parameters are:</p>
<ul>
<li><p>Total: <span class="math inline">\(Y=\sum_Uy_i=\sum_U y_iM_i=\int
ydM=T(M)\)</span></p></li>
<li><p>Ratio of two totals: <span class="math inline">\(R=\frac{Y}{X}=\frac{\int y dM}{\int x
dM}=T(M)\)</span></p></li>
<li><p>Cumulative distribution function: <span class="math inline">\(F(x)=\frac{\sum_U 1(y_i\leq x)}{N}=\frac{\int
1(y\leq x)dM}{\int{dM}}=T(M)\)</span></p></li>
</ul>
<p>To estimate these parameters from the sample, we replace the measure
<span class="math inline">\(M\)</span> by the estimated measure <span class="math inline">\(\hat{M}\)</span> defined by: <span class="math inline">\(\hat{M}(i)=\hat{M}_i= w_i\)</span> if <span class="math inline">\(i\in s\)</span> and <span class="math inline">\(\hat{M}(i)=0\)</span> if <span class="math inline">\(i\notin s\)</span>.</p>
<p>The estimators of the population parameters can then be expressed as
functional of the measure <span class="math inline">\(\hat{M}\)</span>.</p>
<ul>
<li><p>Total: <span class="math inline">\(\hat{Y}=T(\hat{M})=\int
yd\hat{M}=\sum_s w_iy_i\)</span></p></li>
<li><p>Ratio of totals: <span class="math inline">\(\hat{R}=T(\hat{M})=\frac{\int y d\hat{M}}{\int x
d\hat{M}}=\frac{\sum_s w_iy_i}{\sum_s w_ix_i}\)</span></p></li>
<li><p>Cumulative distribution function: <span class="math inline">\(\hat{F}(x)=T(\hat{M})=\frac{\int 1(y\leq
x)d\hat{M}}{\int{d\hat{M}}}=\frac{\sum_s w_i 1(y_i\leq x)}{\sum_s
w_i}\)</span></p></li>
</ul>
</div>
<div class="section level2">
<h2 id="influence-function-examples">Influence Function Examples<a class="anchor" aria-label="anchor" href="#influence-function-examples"></a>
</h2>
<ul>
<li><p>Total: <span class="math display">\[
\begin{aligned}
IT_k(M)&amp;=lim_{t\rightarrow 0}\frac{T(M+t\delta_k)-T(M)}{t}\\
&amp;=lim_{t\rightarrow 0}\frac{\int y.d(M+t\delta_k)-\int y.dM}{t}\\
&amp;=lim_{t\rightarrow 0}\frac{\int yd(t\delta_k)}{t}=y_k  
\end{aligned}
\]</span></p></li>
<li><p>Ratio of two totals: <span class="math display">\[
\begin{aligned}
IR_k(M)&amp;=I\left(\frac{U}{V}\right)_k(M)=\frac{V(M)\times
IU_k(M)-U(M)\times IV_k(M)}{V(M)^2}\\
&amp;=\frac{X y_k-Y x_k}{X^2}=\frac{1}{X}(y_k-Rx_k)
\end{aligned}
\]</span></p></li>
</ul>
</div>
<div class="section level2">
<h2 id="examples-of-linearization-using-the-influence-function">Examples of Linearization Using the Influence Function<a class="anchor" aria-label="anchor" href="#examples-of-linearization-using-the-influence-function"></a>
</h2>
<ul>
<li>At-risk-of-poverty threshold: <span class="math display">\[
arpt = 0.6\times m
\]</span> where <span class="math inline">\(m\)</span> is the median
income.</li>
</ul>
<p><span class="math display">\[
z_k= -\frac{0.6}{f(m)}\times\frac{1}{N}\times\left[I(y_k\leq m-0.5)
\right]
\]</span></p>
<ul>
<li>At-risk-of-poverty rate:</li>
</ul>
<p><span class="math display">\[
arpr=\frac{\sum_U I(y_i \leq t)}{\sum_U w_i}.100
\]</span> <span class="math display">\[
z_k=\frac{1}{N}\left[I(y_k\leq
t)-t\right]-\frac{0.6}{N}\times\frac{f(t)}{f(m)}\left[I(y_k\leq
m)-0.5\right]
\]</span></p>
<p>where:</p>
<p><span class="math inline">\(N\)</span> - population size;</p>
<p><span class="math inline">\(t\)</span> - at-risk-of-poverty
threshold;</p>
<p><span class="math inline">\(y_k\)</span> - income of person <span class="math inline">\(k\)</span>;</p>
<p><span class="math inline">\(m\)</span> - median income;</p>
<p><span class="math inline">\(f\)</span> - income density function;</p>
</div>
<div class="section level2">
<h2 id="replication-designs">Replication Designs<a class="anchor" aria-label="anchor" href="#replication-designs"></a>
</h2>
<p>All major functions in the library convey have S3 methods for the
classes: <code>survey.design</code>, <code>svyrep.design</code> and
<code>DBIdesign</code>. When the argument <code>design</code> is<br>
a survey design with replicate weights created by the library survey,
convey uses the method <code>svrepdesign</code>.</p>
<p>Considering the remarks in <span class="citation">(Wolter
1985)</span>, p. 163, concerning the deficiency of the
<code>Jackknife</code> method in estimating the variance of
<code>quantiles</code>, we adopted the type bootstrap instead.</p>
<p>The function <code>bootVar</code> from the library
<code>laeken</code> , <span class="citation">(Alfons and Templ
2013)</span>, also uses the bootstrap method to estimate variances.</p>
</div>
<div class="section level2">
<h2 id="decomposition">Decomposition<a class="anchor" aria-label="anchor" href="#decomposition"></a>
</h2>
<p>Some inequality and multidimensional poverty measures can be
decomposed. As of December 2016, the decomposition methods in
<code>convey</code> are limited to group decomposition.</p>
<p>For instance, the generalized entropy index can be decomposed into
between and within group components. This sheds light on a very simple
question: of the overall inequality, how much can be explained by
inequalities between groups and within groups? Since this measure is
additive decomposable, one can get estimates of the coefficients, SEs
and covariance between components. For a more practical approach, see
<span class="citation">(Lima 2013)</span>.</p>
<p>The Alkire-Foster class of multidimensional poverty indices can be
decomposed by dimension and groups. This shows how much each group (or
dimension) contribute to the overall poverty.</p>
<p>This technique can help understand where and who is more affected by
inequality and poverty, contributing to more specific policy and
economic analysis.</p>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-R-laeken" class="csl-entry">
Alfons, Andreas, and Matthias Templ. 2013. <span>“Estimation of Social
Exclusion Indicators from Complex Surveys: The <span>R</span> Package
<span class="nocase">laeken</span>.”</span> <em>Journal of Statistical
Software</em> 54 (15): 1–25. <a href="http://www.jstatsoft.org/v54/i15/" class="external-link">http://www.jstatsoft.org/v54/i15/</a>.
</div>
<div id="ref-deville1999" class="csl-entry">
Deville, Jean-Claude. 1999. <span>“Variance Estimation for Complex
Statistics and Estimators: Linearization and Residual
Techniques.”</span> <em>Survey Methodology</em> 25 (2): 193–203. <a href="http://www.statcan.gc.ca/pub/12-001-x/1999002/article/4882-eng.pdf" class="external-link">http://www.statcan.gc.ca/pub/12-001-x/1999002/article/4882-eng.pdf</a>.
</div>
<div id="ref-lima2013" class="csl-entry">
Lima, Luis Cristovao Ferreira. 2013. <span>“<span class="nocase">The
Persistent Inequality in the Great Brazilian Cities: The Case of
Brasília</span>.”</span> MPRA Papers 50938. University of Brasília. <a href="https://mpra.ub.uni-muenchen.de/50938/" class="external-link">https://mpra.ub.uni-muenchen.de/50938/</a>.
</div>
<div id="ref-osier2009" class="csl-entry">
Osier, Guillaume. 2009. <span>“Variance Estimation for Complex
Indicators of Poverty and Inequality.”</span> <em>Journal of the
European Survey Research Association</em> 3 (3): 167–95. <a href="http://ojs.ub.uni-konstanz.de/srm/article/view/369" class="external-link">http://ojs.ub.uni-konstanz.de/srm/article/view/369</a>.
</div>
<div id="ref-W85" class="csl-entry">
Wolter, K. M. 1985. <em>Introduction to Variance Estimation</em>. New
York: Springer-Verlag.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Djalma Pessoa, Anthony Damico, Guilherme Jacob.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
